{"version":3,"sources":["../../src/observe/shadow-mutations.js"],"names":["context","callback","config","TypeError","window","MutationObserver","disengage","element","label","resolveDocument","defaultToDocument","service","ShadowMutationObserver","shadowObserverConfig","childList","subtree","bind","clientObserver","hostObserver","mutations","forEach","handleHostMutation","observeContext","observeShadowHosts","disconnect","hosts","shadowRoot","observe","mutation","type","addedElements","addedNodes","filter","nodeType","Node","ELEMENT_NODE"],"mappings":";;;;;;;;;;;;;;;;;;;oBAqDe,YAIP;AAAA,oFAAJ,EAAI;AAAA,QAHNA,OAGM,SAHNA,OAGM;AAAA,QAFNC,QAEM,SAFNA,QAEM;AAAA,QADNC,MACM,SADNA,MACM;;AACN,QAAI,OAAOD,QAAP,KAAoB,UAAxB,EAAoC;AAClC,YAAM,IAAIE,SAAJ,CAAc,qEAAd,CAAN;AACD;;AAED,QAAI,QAAOD,MAAP,yCAAOA,MAAP,OAAkB,QAAtB,EAAgC;AAC9B,YAAM,IAAIC,SAAJ,CAAc,kEAAd,CAAN;AACD;;AAED,QAAI,CAACC,OAAOC,gBAAZ,EAA8B;AAC5B;AACA;AACA,aAAO;AACLC,mBAAW,qBAAW,CAAE;AADnB,OAAP;AAGD;;AAED,QAAMC,UAAU,gCAAiB;AAC/BC,aAAO,0BADwB;AAE/BC,uBAAiB,IAFc;AAG/BC,yBAAmB,IAHY;AAI/BV;AAJ+B,KAAjB,CAAhB;;AAOA,QAAMW,UAAU,IAAIC,sBAAJ,CAA2B;AACzCZ,eAASO,OADgC;AAEzCN,wBAFyC;AAGzCC;AAHyC,KAA3B,CAAhB;;AAMA,WAAO;AACLI,iBAAWK,QAAQL;AADd,KAAP;AAGD,G;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AArFD,MAAMO,uBAAuB;AAC3BC,eAAW,IADgB;AAE3BC,aAAS;AAFkB,GAA7B;;MAKMH,sB;AACJ,sCAA8C;AAAA;;AAAA,qFAAJ,EAAI;AAAA,UAAjCZ,OAAiC,QAAjCA,OAAiC;AAAA,UAAxBC,QAAwB,QAAxBA,QAAwB;AAAA,UAAdC,MAAc,QAAdA,MAAc;;AAAA;;AAC5C,WAAKA,MAAL,GAAcA,MAAd;;AAEA,WAAKI,SAAL,GAAiB,KAAKA,SAAL,CAAeU,IAAf,CAAoB,IAApB,CAAjB;;AAEA,WAAKC,cAAL,GAAsB,IAAIZ,gBAAJ,CAAqBJ,QAArB,CAAtB;AACA,WAAKiB,YAAL,GAAoB,IAAIb,gBAAJ,CAAqB;AAAA,eAAac,UAAUC,OAAV,CAAkB,MAAKC,kBAAvB,QAAb;AAAA,OAArB,CAApB;;AAEA,WAAKC,cAAL,CAAoBtB,OAApB;AACA,WAAKuB,kBAAL,CAAwBvB,OAAxB;AACD;;;;kCAEW;AACV,aAAKiB,cAAL,IAAuB,KAAKA,cAAL,CAAoBO,UAApB,EAAvB;AACA,aAAKP,cAAL,GAAsB,IAAtB;AACA,aAAKC,YAAL,IAAqB,KAAKA,YAAL,CAAkBM,UAAlB,EAArB;AACA,aAAKN,YAAL,GAAoB,IAApB;AACD;;;yCAEkBlB,O,EAAS;AAAA;;AAC1B,YAAMyB,QAAQ,2BAAiB;AAC7BzB;AAD6B,SAAjB,CAAd;;AAIAyB,cAAML,OAAN,CAAc;AAAA,iBAAW,OAAKE,cAAL,CAAoBf,QAAQmB,UAA5B,CAAX;AAAA,SAAd;AACD;;;qCAEc1B,O,EAAS;AACtB,aAAKiB,cAAL,CAAoBU,OAApB,CAA4B3B,OAA5B,EAAqC,KAAKE,MAA1C;AACA,aAAKgB,YAAL,CAAkBS,OAAlB,CAA0B3B,OAA1B,EAAmCa,oBAAnC;AACD;;;yCAEkBe,Q,EAAU;AAC3B,YAAIA,SAASC,IAAT,KAAkB,WAAtB,EAAmC;AACjC;AACD;;AAED,YAAMC,gBAAgB,yBAAUF,SAASG,UAAnB,EAA+BC,MAA/B,CAAsC;AAAA,iBAAWzB,QAAQ0B,QAAR,KAAqBC,KAAKC,YAArC;AAAA,SAAtC,CAAtB;AACAL,sBAAcV,OAAd,CAAsB,KAAKG,kBAA3B,EAA+C,IAA/C;AACD","file":"shadow-mutations.js","sourcesContent":["\nimport nodeArray from '../util/node-array';\nimport queryShadowHosts from '../query/shadow-hosts';\nimport contextToElement from '../util/context-to-element';\n\nconst shadowObserverConfig = {\n  childList: true,\n  subtree: true,\n};\n\nclass ShadowMutationObserver {\n  constructor({context, callback, config} = {}) {\n    this.config = config;\n\n    this.disengage = this.disengage.bind(this);\n\n    this.clientObserver = new MutationObserver(callback);\n    this.hostObserver = new MutationObserver(mutations => mutations.forEach(this.handleHostMutation, this));\n\n    this.observeContext(context);\n    this.observeShadowHosts(context);\n  }\n\n  disengage() {\n    this.clientObserver && this.clientObserver.disconnect();\n    this.clientObserver = null;\n    this.hostObserver && this.hostObserver.disconnect();\n    this.hostObserver = null;\n  }\n\n  observeShadowHosts(context) {\n    const hosts = queryShadowHosts({\n      context,\n    });\n\n    hosts.forEach(element => this.observeContext(element.shadowRoot));\n  }\n\n  observeContext(context) {\n    this.clientObserver.observe(context, this.config);\n    this.hostObserver.observe(context, shadowObserverConfig);\n  }\n\n  handleHostMutation(mutation) {\n    if (mutation.type !== 'childList') {\n      return;\n    }\n\n    const addedElements = nodeArray(mutation.addedNodes).filter(element => element.nodeType === Node.ELEMENT_NODE);\n    addedElements.forEach(this.observeShadowHosts, this);\n  }\n}\n\nexport default function({\n  context,\n  callback,\n  config,\n} = {}) {\n  if (typeof callback !== 'function') {\n    throw new TypeError('observe/shadow-mutations requires options.callback to be a function');\n  }\n\n  if (typeof config !== 'object') {\n    throw new TypeError('observe/shadow-mutations requires options.config to be an object');\n  }\n\n  if (!window.MutationObserver) {\n    // not supporting IE10 via Mutation Events, because they're too expensive\n    // https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events\n    return {\n      disengage: function() {},\n    };\n  }\n\n  const element = contextToElement({\n    label: 'observe/shadow-mutations',\n    resolveDocument: true,\n    defaultToDocument: true,\n    context,\n  });\n\n  const service = new ShadowMutationObserver({\n    context: element,\n    callback,\n    config,\n  });\n\n  return {\n    disengage: service.disengage,\n  };\n}\n"]}