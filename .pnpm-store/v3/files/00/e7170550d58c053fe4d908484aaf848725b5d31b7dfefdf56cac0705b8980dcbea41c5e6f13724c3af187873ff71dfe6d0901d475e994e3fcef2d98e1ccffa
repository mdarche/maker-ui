{"version":3,"sources":["../../src/query/tabsequence.js"],"names":["queryTabbable","nodeArray","platform","sortArea","sortShadowed","sortTabindex","_supports","supports","moveContextToBeginning","elements","context","pos","indexOf","tmp","splice","concat","sortElements","_context","tabsequenceAreaAtImgPosition","includeContext","includeOnlyTabbable","strategy","document","documentElement","body","createShadowRoot","is","BLINK"],"mappings":";AACA;AACA;;AAEA,OAAOA,aAAP,MAA0B,YAA1B;AACA,OAAOC,SAAP,MAAsB,oBAAtB;AACA,OAAOC,QAAP,MAAqB,kBAArB;AACA,OAAOC,QAAP,MAAqB,yBAArB;AACA,OAAOC,YAAP,MAAyB,6BAAzB;AACA,OAAOC,YAAP,MAAyB,6BAAzB;AACA,OAAOC,SAAP,MAAsB,sBAAtB;AACA,IAAIC,iBAAJ;;AAEA,SAASC,sBAAT,CAAgCC,QAAhC,EAA0CC,OAA1C,EAAmD;AACjD,MAAMC,MAAMF,SAASG,OAAT,CAAiBF,OAAjB,CAAZ;AACA,MAAIC,MAAM,CAAV,EAAa;AACX,QAAME,MAAMJ,SAASK,MAAT,CAAgBH,GAAhB,EAAqB,CAArB,CAAZ;AACA,WAAOE,IAAIE,MAAJ,CAAWN,QAAX,CAAP;AACD;;AAED,SAAOA,QAAP;AACD;;AAED,SAASO,YAAT,CAAsBP,QAAtB,EAAgCQ,QAAhC,EAA0C;AACxC,MAAIV,SAASW,4BAAb,EAA2C;AACzC;AACA;AACA;AACAT,eAAWN,SAASM,QAAT,EAAmBQ,QAAnB,CAAX;AACD;;AAEDR,aAAWJ,aAAaI,QAAb,CAAX;AACA,SAAOA,QAAP;AACD;;AAED,eAAe,YAKP;AAAA,iFAAJ,EAAI;AAAA,MAJNC,OAIM,QAJNA,OAIM;AAAA,MAHNS,cAGM,QAHNA,cAGM;AAAA,MAFNC,mBAEM,QAFNA,mBAEM;AAAA,MADNC,QACM,QADNA,QACM;;AACN,MAAI,CAACd,QAAL,EAAe;AACbA,eAAWD,WAAX;AACD;;AAED,MAAMW,WAAWhB,UAAUS,OAAV,EAAmB,CAAnB,KAAyBY,SAASC,eAAnD;AACA,MAAId,WAAWT,cAAc;AAC3BU,aAASO,QADkB;AAE3BE,kCAF2B;AAG3BC,4CAH2B;AAI3BC;AAJ2B,GAAd,CAAf;;AAOA,MAAIC,SAASE,IAAT,CAAcC,gBAAd,IAAkCvB,SAASwB,EAAT,CAAYC,KAAlD,EAAyD;AACvD;AACA;AACAlB,eAAWL,aAAaK,QAAb,EAAuBQ,QAAvB,EAAiCD,YAAjC,CAAX;AACD,GAJD,MAIO;AACLP,eAAWO,aAAaP,QAAb,EAAuBQ,QAAvB,CAAX;AACD;;AAED,MAAIE,cAAJ,EAAoB;AAClB;AACA;AACAV,eAAWD,uBAAuBC,QAAvB,EAAiCQ,QAAjC,CAAX;AACD;;AAED,SAAOR,QAAP;AACD","file":"tabsequence.js","sourcesContent":["\n// https://www.w3.org/TR/html5/editing.html#sequential-focus-navigation-and-the-tabindex-attribute\n// https://www.w3.org/WAI/PF/aria-practices/#keyboard\n\nimport queryTabbable from './tabbable';\nimport nodeArray from '../util/node-array';\nimport platform from '../util/platform';\nimport sortArea from './tabsequence.sort-area';\nimport sortShadowed from './tabsequence.sort-shadowed';\nimport sortTabindex from './tabsequence.sort-tabindex';\nimport _supports from '../supports/supports';\nlet supports;\n\nfunction moveContextToBeginning(elements, context) {\n  const pos = elements.indexOf(context);\n  if (pos > 0) {\n    const tmp = elements.splice(pos, 1);\n    return tmp.concat(elements);\n  }\n\n  return elements;\n}\n\nfunction sortElements(elements, _context) {\n  if (supports.tabsequenceAreaAtImgPosition) {\n    // Some browsers sort <area> in DOM order, some place the <area>s\n    // where the <img> referecing them would've been in DOM order.\n    // https://github.com/medialize/ally.js/issues/5\n    elements = sortArea(elements, _context);\n  }\n\n  elements = sortTabindex(elements);\n  return elements;\n}\n\nexport default function({\n  context,\n  includeContext,\n  includeOnlyTabbable,\n  strategy,\n} = {}) {\n  if (!supports) {\n    supports = _supports();\n  }\n\n  const _context = nodeArray(context)[0] || document.documentElement;\n  let elements = queryTabbable({\n    context: _context,\n    includeContext,\n    includeOnlyTabbable,\n    strategy,\n  });\n\n  if (document.body.createShadowRoot && platform.is.BLINK) {\n    // sort tabindex localized to shadow dom\n    // see https://github.com/medialize/ally.js/issues/6\n    elements = sortShadowed(elements, _context, sortElements);\n  } else {\n    elements = sortElements(elements, _context);\n  }\n\n  if (includeContext) {\n    // if we include the context itself, it has to be the first\n    // element of the sequence\n    elements = moveContextToBeginning(elements, _context);\n  }\n\n  return elements;\n}\n"]}