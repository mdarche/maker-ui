{"version":3,"sources":["../../src/element/focus.js"],"names":["focusSvgForeignObjectHack","getFocusTarget","isActiveElement","isFocusable","contextToElement","getWindow","resetScrolling","focus","element","_window","HTMLElement","prototype","call","e","actionPerformed","except","flexbox","scrollable","onlyTabbable","context","defaultToAncestor","undoScrolling","label","targetIsFocusable","rules","target","_undoScrolling","result"],"mappings":";AACA;;AAEA,OAAOA,yBAAP,MAAsC,iCAAtC;AACA,OAAOC,cAAP,MAA2B,qBAA3B;AACA,OAAOC,eAAP,MAA4B,sBAA5B;AACA,OAAOC,WAAP,MAAwB,iBAAxB;AACA,OAAOC,gBAAP,MAA6B,4BAA7B;AACA,OAAOC,SAAP,MAAsB,oBAAtB;AACA,OAAOC,cAAP,MAA2B,yBAA3B;;AAEA,SAASC,KAAT,CAAeC,OAAf,EAAwB;AACtB,MAAIA,QAAQD,KAAZ,EAAmB;AACjBC,YAAQD,KAAR;AACA,WAAOL,gBAAgBM,OAAhB,IAA2BA,OAA3B,GAAqC,IAA5C;AACD;;AAED,MAAMC,UAAUJ,UAAUG,OAAV,CAAhB;;AAEA,MAAI;AACF;AACA;AACA;AACA;AACA;AACAC,YAAQC,WAAR,CAAoBC,SAApB,CAA8BJ,KAA9B,CAAoCK,IAApC,CAAyCJ,OAAzC;AACA,WAAON,gBAAgBM,OAAhB,IAA2BA,OAA3B,GAAqC,IAA5C;AACD,GARD,CAQE,OAAOK,CAAP,EAAU;AACV,QAAMC,kBAAkBd,0BAA0BQ,OAA1B,CAAxB;AACA,WAAOM,mBAAmBZ,gBAAgBM,OAAhB,CAAnB,GAA8CA,OAA9C,GAAwD,IAA/D;AACD;AACF;;AAED,IAAMO,SAAS;AACb;AACAC,WAAS,IAFI;AAGb;AACA;AACAC,cAAY,IALC;AAMb;AACAC,gBAAc;AAPD,CAAf;;AAUA,eAAe,UAASC,OAAT,EAGP;AAAA,iFAAJ,EAAI;AAAA,MAFNC,iBAEM,QAFNA,iBAEM;AAAA,MADNC,aACM,QADNA,aACM;;AACN,MAAMb,UAAUJ,iBAAiB;AAC/BkB,WAAO,eADwB;AAE/BH;AAF+B,GAAjB,CAAhB;;AAKA,MAAMI,oBAAoBpB,YAAYqB,KAAZ,CAAkB;AAC1CL,aAASX,OADiC;AAE1CO;AAF0C,GAAlB,CAA1B;;AAKA,MAAI,CAACK,iBAAD,IAAsB,CAACG,iBAA3B,EAA8C;AAC5C,WAAO,IAAP;AACD;;AAED,MAAME,SAASxB,eAAe;AAC5BkB,aAASX,OADmB;AAE5BO;AAF4B,GAAf,CAAf;;AAKA,MAAI,CAACU,MAAL,EAAa;AACX,WAAO,IAAP;AACD;;AAED,MAAIvB,gBAAgBuB,MAAhB,CAAJ,EAA6B;AAC3B,WAAOA,MAAP;AACD;;AAED,MAAIC,uBAAJ;AACA,MAAIL,aAAJ,EAAmB;AACjBK,qBAAiBpB,eAAemB,MAAf,CAAjB;AACD;;AAED,MAAME,SAASpB,MAAMkB,MAAN,CAAf;;AAEAC,oBAAkBA,gBAAlB;;AAEA,SAAOC,MAAP;AACD","file":"focus.js","sourcesContent":["\n// wrapper for HTMLElement.prototype.focus\n\nimport focusSvgForeignObjectHack from './focus.svg-foreign-object-hack';\nimport getFocusTarget from '../get/focus-target';\nimport isActiveElement from '../is/active-element';\nimport isFocusable from '../is/focusable';\nimport contextToElement from '../util/context-to-element';\nimport getWindow from '../util/get-window';\nimport resetScrolling from '../util/reset-scrolling';\n\nfunction focus(element) {\n  if (element.focus) {\n    element.focus();\n    return isActiveElement(element) ? element : null;\n  }\n\n  const _window = getWindow(element);\n\n  try {\n    // The element itself does not have a focus method.\n    // This is true for SVG elements in Firefox and IE,\n    // as well as MathML elements in every browser.\n    // IE9 - 11 will let us abuse HTMLElement's focus method,\n    // Firefox and Edge will throw an error.\n    _window.HTMLElement.prototype.focus.call(element);\n    return isActiveElement(element) ? element : null;\n  } catch (e) {\n    const actionPerformed = focusSvgForeignObjectHack(element);\n    return actionPerformed && isActiveElement(element) ? element : null;\n  }\n}\n\nconst except = {\n  // exclude elements affected by the IE flexbox bug\n  flexbox: true,\n  // exclude overflowing elements that are not intentionally\n  // made focusable by adding a tabindex attribute\n  scrollable: true,\n  // include elements that don't have a focus() method\n  onlyTabbable: true,\n};\n\nexport default function(context, {\n  defaultToAncestor,\n  undoScrolling,\n} = {}) {\n  const element = contextToElement({\n    label: 'element/focus',\n    context,\n  });\n\n  const targetIsFocusable = isFocusable.rules({\n    context: element,\n    except,\n  });\n\n  if (!defaultToAncestor && !targetIsFocusable) {\n    return null;\n  }\n\n  const target = getFocusTarget({\n    context: element,\n    except,\n  });\n\n  if (!target) {\n    return null;\n  }\n\n  if (isActiveElement(target)) {\n    return target;\n  }\n\n  let _undoScrolling;\n  if (undoScrolling) {\n    _undoScrolling = resetScrolling(target);\n  }\n\n  const result = focus(target);\n\n  _undoScrolling && _undoScrolling();\n\n  return result;\n}\n"]}