{"version":3,"sources":["../../src/query/tabsequence.js"],"names":["context","includeContext","includeOnlyTabbable","strategy","supports","_context","document","documentElement","elements","body","createShadowRoot","is","BLINK","sortElements","moveContextToBeginning","pos","indexOf","tmp","splice","concat","tabsequenceAreaAtImgPosition"],"mappings":";;;;;;kBAmCe,YAKP;AAAA,iFAAJ,EAAI;AAAA,MAJNA,OAIM,QAJNA,OAIM;AAAA,MAHNC,cAGM,QAHNA,cAGM;AAAA,MAFNC,mBAEM,QAFNA,mBAEM;AAAA,MADNC,QACM,QADNA,QACM;;AACN,MAAI,CAACC,QAAL,EAAe;AACbA,eAAW,yBAAX;AACD;;AAED,MAAMC,WAAW,yBAAUL,OAAV,EAAmB,CAAnB,KAAyBM,SAASC,eAAnD;AACA,MAAIC,WAAW,wBAAc;AAC3BR,aAASK,QADkB;AAE3BJ,kCAF2B;AAG3BC,4CAH2B;AAI3BC;AAJ2B,GAAd,CAAf;;AAOA,MAAIG,SAASG,IAAT,CAAcC,gBAAd,IAAkC,mBAASC,EAAT,CAAYC,KAAlD,EAAyD;AACvD;AACA;AACAJ,eAAW,2BAAaA,QAAb,EAAuBH,QAAvB,EAAiCQ,YAAjC,CAAX;AACD,GAJD,MAIO;AACLL,eAAWK,aAAaL,QAAb,EAAuBH,QAAvB,CAAX;AACD;;AAED,MAAIJ,cAAJ,EAAoB;AAClB;AACA;AACAO,eAAWM,uBAAuBN,QAAvB,EAAiCH,QAAjC,CAAX;AACD;;AAED,SAAOG,QAAP;AACD,C;;AAhED;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AACA,IAAIJ,iBAAJ;AAVA;AACA;;AAWA,SAASU,sBAAT,CAAgCN,QAAhC,EAA0CR,OAA1C,EAAmD;AACjD,MAAMe,MAAMP,SAASQ,OAAT,CAAiBhB,OAAjB,CAAZ;AACA,MAAIe,MAAM,CAAV,EAAa;AACX,QAAME,MAAMT,SAASU,MAAT,CAAgBH,GAAhB,EAAqB,CAArB,CAAZ;AACA,WAAOE,IAAIE,MAAJ,CAAWX,QAAX,CAAP;AACD;;AAED,SAAOA,QAAP;AACD;;AAED,SAASK,YAAT,CAAsBL,QAAtB,EAAgCH,QAAhC,EAA0C;AACxC,MAAID,SAASgB,4BAAb,EAA2C;AACzC;AACA;AACA;AACAZ,eAAW,2BAASA,QAAT,EAAmBH,QAAnB,CAAX;AACD;;AAEDG,aAAW,2BAAaA,QAAb,CAAX;AACA,SAAOA,QAAP;AACD","file":"tabsequence.js","sourcesContent":["\n// https://www.w3.org/TR/html5/editing.html#sequential-focus-navigation-and-the-tabindex-attribute\n// https://www.w3.org/WAI/PF/aria-practices/#keyboard\n\nimport queryTabbable from './tabbable';\nimport nodeArray from '../util/node-array';\nimport platform from '../util/platform';\nimport sortArea from './tabsequence.sort-area';\nimport sortShadowed from './tabsequence.sort-shadowed';\nimport sortTabindex from './tabsequence.sort-tabindex';\nimport _supports from '../supports/supports';\nlet supports;\n\nfunction moveContextToBeginning(elements, context) {\n  const pos = elements.indexOf(context);\n  if (pos > 0) {\n    const tmp = elements.splice(pos, 1);\n    return tmp.concat(elements);\n  }\n\n  return elements;\n}\n\nfunction sortElements(elements, _context) {\n  if (supports.tabsequenceAreaAtImgPosition) {\n    // Some browsers sort <area> in DOM order, some place the <area>s\n    // where the <img> referecing them would've been in DOM order.\n    // https://github.com/medialize/ally.js/issues/5\n    elements = sortArea(elements, _context);\n  }\n\n  elements = sortTabindex(elements);\n  return elements;\n}\n\nexport default function({\n  context,\n  includeContext,\n  includeOnlyTabbable,\n  strategy,\n} = {}) {\n  if (!supports) {\n    supports = _supports();\n  }\n\n  const _context = nodeArray(context)[0] || document.documentElement;\n  let elements = queryTabbable({\n    context: _context,\n    includeContext,\n    includeOnlyTabbable,\n    strategy,\n  });\n\n  if (document.body.createShadowRoot && platform.is.BLINK) {\n    // sort tabindex localized to shadow dom\n    // see https://github.com/medialize/ally.js/issues/6\n    elements = sortShadowed(elements, _context, sortElements);\n  } else {\n    elements = sortElements(elements, _context);\n  }\n\n  if (includeContext) {\n    // if we include the context itself, it has to be the first\n    // element of the sequence\n    elements = moveContextToBeginning(elements, _context);\n  }\n\n  return elements;\n}\n"]}