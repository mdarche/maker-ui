{"version":3,"sources":["../../src/is/focus-relevant.js"],"names":["supports","isFocusRelevantRules","context","except","flexbox","scrollable","shadow","element","label","resolveDocument","shadowRoot","nodeName","toLowerCase","type","focusRedirectLegend","hasAttribute","svgType","getAttribute","focusObjectSvg","focusObjectSwf","focusAudioWithoutControls","focusVideoWithoutControls","focusSummary","validTabindex","focusImgUsemapTabindex","focusRedirectImgUsemap","focusTable","focusFieldset","isSvgElement","isSvgContent","ownerSVGElement","focusableAttribute","tabindex","focusSvgUseTabindex","focusSvgForeignobjectTabindex","focus","focusSvgNegativeTabindexAttribute","focusSvg","focusSvgInIframe","Boolean","focusSvgFocusableAttribute","focusSvgTabindexAttribute","style","window","getComputedStyle","focusImgIsmap","hasLinkParent","some","parent","focusScrollContainer","focusScrollContainerWithoutOverflow","focusFlexboxContainer","parentElement","parentNodeName","parentStyle","focusScrollBody","focusChildrenOfFocusableFlexbox","isFocusRelevant","rules"],"mappings":"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","file":"focus-relevant.js","sourcesContent":["\n// determine if an element supports.can be focused by script regardless\n// of the element actually being focusable at the time of execution\n// i.e. <input disabled> is conisdered focus-relevant, but not focusable\n\nimport getParents from '../get/parents';\nimport contextToElement from '../util/context-to-element';\nimport elementMatches from '../util/element-matches';\nimport tabindexValue from '../util/tabindex-value';\nimport isValidTabindex from './valid-tabindex';\nimport {\n  hasCssOverflowScroll,\n  hasCssDisplayFlex,\n  isScrollableContainer,\n  isUserModifyWritable,\n} from './is.util';\n\nimport _supports from '../supports/supports';\nlet supports;\n\nfunction isFocusRelevantRules({\n  context,\n  except = {\n    flexbox: false,\n    scrollable: false,\n    shadow: false,\n  },\n} = {}) {\n  if (!supports) {\n    supports = _supports();\n  }\n\n  const element = contextToElement({\n    label: 'is/focus-relevant',\n    resolveDocument: true,\n    context,\n  });\n\n  if (!except.shadow && element.shadowRoot) {\n    // a ShadowDOM host receives focus when the focus moves to its content\n    return true;\n  }\n\n  const nodeName = element.nodeName.toLowerCase();\n\n  if (nodeName === 'input' && element.type === 'hidden') {\n    // input[type=\"hidden\"] supports.cannot be focused\n    return false;\n  }\n\n  if (nodeName === 'input' || nodeName === 'select' || nodeName === 'button' || nodeName === 'textarea') {\n    return true;\n  }\n\n  if (nodeName === 'legend' && supports.focusRedirectLegend) {\n    // specifics filtered in is/focusable\n    return true;\n  }\n\n  if (nodeName === 'label') {\n    // specifics filtered in is/focusable\n    return true;\n  }\n\n  if (nodeName === 'area') {\n    // specifics filtered in is/focusable\n    return true;\n  }\n\n  if (nodeName === 'a' && element.hasAttribute('href')) {\n    return true;\n  }\n\n  if (nodeName === 'object' && element.hasAttribute('usemap')) {\n    // object[usemap] is not focusable in any browser\n    return false;\n  }\n\n  if (nodeName === 'object') {\n    const svgType = element.getAttribute('type');\n    if (!supports.focusObjectSvg && svgType === 'image/svg+xml') {\n      // object[type=\"image/svg+xml\"] is not focusable in Internet Explorer\n      return false;\n    } else if (!supports.focusObjectSwf && svgType === 'application/x-shockwave-flash') {\n      // object[type=\"application/x-shockwave-flash\"] is not focusable in Internet Explorer 9\n      return false;\n    }\n  }\n\n  if (nodeName === 'iframe' || nodeName === 'object') {\n    // browsing context containers\n    return true;\n  }\n\n  if (nodeName === 'embed' || nodeName === 'keygen') {\n    // embed is considered focus-relevant but not focusable\n    // see https://github.com/medialize/ally.js/issues/82\n    return true;\n  }\n\n  if (element.hasAttribute('contenteditable')) {\n    // also see CSS property user-modify below\n    return true;\n  }\n\n  if (nodeName === 'audio' && (supports.focusAudioWithoutControls || element.hasAttribute('controls'))) {\n    return true;\n  }\n\n  if (nodeName === 'video' && (supports.focusVideoWithoutControls || element.hasAttribute('controls'))) {\n    return true;\n  }\n\n  if (supports.focusSummary && nodeName === 'summary') {\n    return true;\n  }\n\n  const validTabindex = isValidTabindex(element);\n\n  if (nodeName === 'img' && element.hasAttribute('usemap')) {\n    // Gecko, Trident and Edge do not allow an image with an image map and tabindex to be focused,\n    // it appears the tabindex is overruled so focus is still forwarded to the <map>\n    return validTabindex && supports.focusImgUsemapTabindex || supports.focusRedirectImgUsemap;\n  }\n\n  if (supports.focusTable && (nodeName === 'table' || nodeName === 'td')) {\n    // IE10-11 supports.can focus <table> and <td>\n    return true;\n  }\n\n  if (supports.focusFieldset && nodeName === 'fieldset') {\n    // IE10-11 supports.can focus <fieldset>\n    return true;\n  }\n\n  const isSvgElement = nodeName === 'svg';\n  const isSvgContent = element.ownerSVGElement;\n  const focusableAttribute = element.getAttribute('focusable');\n  const tabindex = tabindexValue(element);\n\n  if (nodeName === 'use' && tabindex !== null && !supports.focusSvgUseTabindex) {\n    // <use> cannot be made focusable by adding a tabindex attribute anywhere but Blink and WebKit\n    return false;\n  }\n\n  if (nodeName === 'foreignobject') {\n    // <use> can only be made focusable in Blink and WebKit\n    return tabindex !== null && supports.focusSvgForeignobjectTabindex;\n  }\n\n  if (elementMatches(element, 'svg a') && element.hasAttribute('xlink:href')) {\n    return true;\n  }\n\n  if ((isSvgElement || isSvgContent) && element.focus && !supports.focusSvgNegativeTabindexAttribute && tabindex < 0) {\n    // Firefox 51 and 52 treat any natively tabbable SVG element with\n    // tabindex=\"-1\" as tabbable and everything else as inert\n    // see https://bugzilla.mozilla.org/show_bug.cgi?id=1302340\n    return false;\n  }\n\n  if (isSvgElement) {\n    return validTabindex || supports.focusSvg || supports.focusSvgInIframe\n      // Internet Explorer understands the focusable attribute introduced in SVG Tiny 1.2\n      || Boolean(supports.focusSvgFocusableAttribute && focusableAttribute && focusableAttribute === 'true');\n  }\n\n  if (isSvgContent) {\n    if (supports.focusSvgTabindexAttribute && validTabindex) {\n      return true;\n    }\n\n    if (supports.focusSvgFocusableAttribute) {\n      // Internet Explorer understands the focusable attribute introduced in SVG Tiny 1.2\n      return focusableAttribute === 'true';\n    }\n  }\n\n  // https://www.w3.org/TR/html5/editing.html#sequential-focus-navigation-and-the-tabindex-attribute\n  if (validTabindex) {\n    return true;\n  }\n\n  const style = window.getComputedStyle(element, null);\n  if (isUserModifyWritable(style)) {\n    return true;\n  }\n\n  if (supports.focusImgIsmap && nodeName === 'img' && element.hasAttribute('ismap')) {\n    // IE10-11 considers the <img> in <a href><img ismap> focusable\n    // https://github.com/medialize/ally.js/issues/20\n    const hasLinkParent = getParents({context: element}).some(\n      parent => parent.nodeName.toLowerCase() === 'a' && parent.hasAttribute('href')\n    );\n\n    if (hasLinkParent) {\n      return true;\n    }\n  }\n\n  // https://github.com/medialize/ally.js/issues/21\n  if (!except.scrollable && supports.focusScrollContainer) {\n    if (supports.focusScrollContainerWithoutOverflow) {\n      // Internet Explorer does will consider the scrollable area focusable\n      // if the element is a <div> or a <span> and it is in fact scrollable,\n      // regardless of the CSS overflow property\n      if (isScrollableContainer(element, nodeName)) {\n        return true;\n      }\n    } else if (hasCssOverflowScroll(style)) {\n      // Firefox requires proper overflow setting, IE does not necessarily\n      // https://developer.mozilla.org/en-US/docs/Web/CSS/overflow\n      return true;\n    }\n  }\n\n  if (!except.flexbox && supports.focusFlexboxContainer && hasCssDisplayFlex(style)) {\n    // elements with display:flex are focusable in IE10-11\n    return true;\n  }\n\n  const parent = element.parentElement;\n  if (!except.scrollable && parent) {\n    const parentNodeName = parent.nodeName.toLowerCase();\n    const parentStyle = window.getComputedStyle(parent, null);\n    if (supports.focusScrollBody && isScrollableContainer(parent, nodeName, parentNodeName, parentStyle)) {\n      // scrollable bodies are focusable Internet Explorer\n      // https://github.com/medialize/ally.js/issues/21\n      return true;\n    }\n\n    // Children of focusable elements with display:flex are focusable in IE10-11\n    if (supports.focusChildrenOfFocusableFlexbox) {\n      if (hasCssDisplayFlex(parentStyle)) {\n        return true;\n      }\n    }\n  }\n\n  // NOTE: elements marked as inert are not focusable,\n  // but that property is not exposed to the DOM\n  // https://www.w3.org/TR/html5/editing.html#inert\n\n  return false;\n}\n\n// bind exceptions to an iterator callback\nisFocusRelevantRules.except = function(except = {}) {\n  const isFocusRelevant = function(context) {\n    return isFocusRelevantRules({\n      context,\n      except,\n    });\n  };\n\n  isFocusRelevant.rules = isFocusRelevantRules;\n  return isFocusRelevant;\n};\n\n// provide isFocusRelevant(context) as default iterator callback\nconst isFocusRelevant = isFocusRelevantRules.except({});\nexport default isFocusRelevant;\n"]}