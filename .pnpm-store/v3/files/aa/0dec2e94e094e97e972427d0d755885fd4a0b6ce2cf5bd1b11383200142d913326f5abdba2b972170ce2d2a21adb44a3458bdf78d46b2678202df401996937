{"version":3,"sources":["../../src/query/tabsequence.sort-area.js"],"names":["elements","context","usemaps","querySelectorAll","maps","Maps","_elements","extractAreasFromList","length","list","resolveElement","image","name","getAttribute","slice","getAreasFor","_document","addMapByName","map","filter","element","nodeName","toLowerCase","parentNode","push"],"mappings":";;;;;;;AACA;;kBAqDe,UAASA,QAAT,EAAmBC,OAAnB,EAA4B;AACzC;AACA;AACA;AACA,MAAMC,UAAUD,QAAQE,gBAAR,CAAyB,aAAzB,CAAhB;AACA,MAAMC,OAAO,IAAIC,IAAJ,CAASJ,OAAT,CAAb;;AAEA;AACA;AACA,MAAMK,YAAYF,KAAKG,oBAAL,CAA0BP,QAA1B,CAAlB;;AAEA,MAAI,CAACE,QAAQM,MAAb,EAAqB;AACnB;AACA;AACA,WAAOF,SAAP;AACD;;AAED,SAAO,6BAAgB;AACrBG,UAAMH,SADe;AAErBN,cAAUE,OAFW;AAGrBQ,oBAAgB,wBAASC,KAAT,EAAgB;AAC9B,UAAMC,OAAOD,MAAME,YAAN,CAAmB,QAAnB,EAA6BC,KAA7B,CAAmC,CAAnC,CAAb;AACA,aAAOV,KAAKW,WAAL,CAAiBH,IAAjB,CAAP;AACD;AANoB,GAAhB,CAAP;AAQD,C;;AA5ED;;;;AACA;;;;AACA;;;;AACA;;;;;;IAEMP,I;AACJ,gBAAYJ,OAAZ,EAAqB;AAAA;;AACnB,SAAKe,SAAL,GAAiB,2BAAYf,OAAZ,CAAjB;AACA,SAAKG,IAAL,GAAY,EAAZ;AACD;;;;gCAEWQ,I,EAAM;AAChB,UAAI,CAAC,KAAKR,IAAL,CAAUQ,IAAV,CAAL,EAAsB;AACpB;AACA;AACA,aAAKK,YAAL,CAAkBL,IAAlB;AACD;;AAED,aAAO,KAAKR,IAAL,CAAUQ,IAAV,CAAP;AACD;;;iCAEYA,I,EAAM;AACjB,UAAMM,MAAM,4BAAaN,IAAb,EAAmB,KAAKI,SAAxB,CAAZ;AACA,UAAI,CAACE,GAAL,EAAU;AACR;AACA;AACD;;AAED,WAAKd,IAAL,CAAUc,IAAIN,IAAd,IAAsB,wBAAc,EAACX,SAASiB,GAAV,EAAd,CAAtB;AACD;;;yCAEoBlB,Q,EAAU;AAC7B;AACA;AACA,aAAOA,SAASmB,MAAT,CAAgB,UAASC,OAAT,EAAkB;AACvC,YAAMC,WAAWD,QAAQC,QAAR,CAAiBC,WAAjB,EAAjB;AACA,YAAID,aAAa,MAAjB,EAAyB;AACvB,iBAAO,IAAP;AACD;;AAED,YAAMH,MAAME,QAAQG,UAApB;AACA,YAAI,CAAC,KAAKnB,IAAL,CAAUc,IAAIN,IAAd,CAAL,EAA0B;AACxB,eAAKR,IAAL,CAAUc,IAAIN,IAAd,IAAsB,EAAtB;AACD;;AAED,aAAKR,IAAL,CAAUc,IAAIN,IAAd,EAAoBY,IAApB,CAAyBJ,OAAzB;AACA,eAAO,KAAP;AACD,OAbM,EAaJ,IAbI,CAAP;AAcD","file":"tabsequence.sort-area.js","sourcesContent":["\n// move <area> elements to the location of the <img> elements that reference them\n\nimport queryTabbable from './tabbable';\nimport mergeInDomOrder from '../util/merge-dom-order';\nimport getDocument from '../util/get-document';\nimport {getMapByName} from '../util/image-map';\n\nclass Maps {\n  constructor(context) {\n    this._document = getDocument(context);\n    this.maps = {};\n  }\n\n  getAreasFor(name) {\n    if (!this.maps[name]) {\n      // the map is not defined within the context, so we\n      // have to go find it elsewhere in the document\n      this.addMapByName(name);\n    }\n\n    return this.maps[name];\n  }\n\n  addMapByName(name) {\n    const map = getMapByName(name, this._document);\n    if (!map) {\n      // if there is no map, the img[usemap] wasn't doing anything anyway\n      return;\n    }\n\n    this.maps[map.name] = queryTabbable({context: map});\n  }\n\n  extractAreasFromList(elements) {\n    // remove all <area> elements from the elements list,\n    // but put them the map for later retrieval\n    return elements.filter(function(element) {\n      const nodeName = element.nodeName.toLowerCase();\n      if (nodeName !== 'area') {\n        return true;\n      }\n\n      const map = element.parentNode;\n      if (!this.maps[map.name]) {\n        this.maps[map.name] = [];\n      }\n\n      this.maps[map.name].push(element);\n      return false;\n    }, this);\n  }\n}\n\nexport default function(elements, context) {\n  // images - unless they are focusable themselves, likely not\n  // part of the elements list, so we'll have to find them and\n  // sort them into the elements list manually\n  const usemaps = context.querySelectorAll('img[usemap]');\n  const maps = new Maps(context);\n\n  // remove all <area> elements from the elements list,\n  // but put them the map for later retrieval\n  const _elements = maps.extractAreasFromList(elements);\n\n  if (!usemaps.length) {\n    // the context does not contain any <area>s so no need\n    // to replace anything, just remove any maps\n    return _elements;\n  }\n\n  return mergeInDomOrder({\n    list: _elements,\n    elements: usemaps,\n    resolveElement: function(image) {\n      const name = image.getAttribute('usemap').slice(1);\n      return maps.getAreasFor(name);\n    },\n  });\n}\n"]}