{"version":3,"sources":["../../src/is/focusable.js"],"names":["supports","isOnlyFocusRelevant","element","nodeName","toLowerCase","_tabindex","shadowRoot","focusLabelTabindex","focusSvgFocusableAttribute","ownerSVGElement","focusableAttribute","getAttribute","hasAttribute","focusImgUsemapTabindex","isFocusableRules","context","except","disabled","visible","onlyTabbable","_isOnlyTabbable","rules","onlyFocusableBrowsingContext","label","resolveDocument","focusRelevant","visibilityOptions","focusInHiddenIframe","browsingContext","focusObjectSvgHidden","cssVisibility","frameElement","_nodeName","focusInZeroDimensionObject","offsetWidth","offsetHeight","focusSvgInIframe","isFocusable"],"mappings":"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","file":"focusable.js","sourcesContent":["\n// determine if an element can be focused\n\n// https://www.w3.org/TR/html5/editing.html#focus-management\n\n// NOTE: The following known issues exist:\n//   Gecko: `svg a[xlink|href]` is not identified as focusable (because SVGElement.prototype.focus is missing)\n//   Blink, WebKit: SVGElements that have been made focusable by adding a focus event listener are not identified as focusable\n\nimport isFocusRelevant from './focus-relevant';\nimport isValidArea from './valid-area';\nimport isVisible from './visible';\nimport isDisabled from './disabled';\nimport isOnlyTabbable from './only-tabbable';\nimport contextToElement from '../util/context-to-element';\nimport getFrameElement from '../util/get-frame-element';\nimport tabindexValue from '../util/tabindex-value';\n\nimport _supports from '../supports/supports';\nlet supports;\n\nfunction isOnlyFocusRelevant(element) {\n  const nodeName = element.nodeName.toLowerCase();\n  if (nodeName === 'embed' || nodeName === 'keygen') {\n    // embed is considered focus-relevant but not focusable\n    // see https://github.com/medialize/ally.js/issues/82\n    return true;\n  }\n\n  const _tabindex = tabindexValue(element);\n  if (element.shadowRoot && _tabindex === null) {\n    // ShadowDOM host elements *may* receive focus\n    // even though they are not considered focuable\n    return true;\n  }\n\n  if (nodeName === 'label') {\n    // <label tabindex=\"0\"> is only tabbable in Firefox, not script-focusable\n    // there's no way to make an element focusable other than by adding a tabindex,\n    // and focus behavior of the label element seems hard-wired to ignore tabindex\n    // in some browsers (like Gecko, Blink and WebKit)\n    return !supports.focusLabelTabindex || _tabindex === null;\n  }\n\n  if (nodeName === 'legend') {\n    return _tabindex === null;\n  }\n\n  if (supports.focusSvgFocusableAttribute && (element.ownerSVGElement || nodeName === 'svg')) {\n    // Internet Explorer understands the focusable attribute introduced in SVG Tiny 1.2\n    const focusableAttribute = element.getAttribute('focusable');\n    return focusableAttribute && focusableAttribute === 'false';\n  }\n\n  if (nodeName === 'img' && element.hasAttribute('usemap')) {\n    // Gecko, Trident and Edge do not allow an image with an image map and tabindex to be focused,\n    // it appears the tabindex is overruled so focus is still forwarded to the <map>\n    return _tabindex === null || !supports.focusImgUsemapTabindex;\n  }\n\n  if (nodeName === 'area') {\n    // all <area>s are considered relevant,\n    // but only the valid <area>s are focusable\n    return !isValidArea(element);\n  }\n\n  return false;\n}\n\nfunction isFocusableRules({\n  context,\n  except = {\n    disabled: false,\n    visible: false,\n    onlyTabbable: false,\n  },\n} = {}) {\n  if (!supports) {\n    supports = _supports();\n  }\n\n  const _isOnlyTabbable = isOnlyTabbable.rules.except({\n    onlyFocusableBrowsingContext: true,\n    visible: except.visible,\n  });\n\n  const element = contextToElement({\n    label: 'is/focusable',\n    resolveDocument: true,\n    context,\n  });\n\n  const focusRelevant = isFocusRelevant.rules({\n    context: element,\n    except,\n  });\n\n  if (!focusRelevant || isOnlyFocusRelevant(element)) {\n    return false;\n  }\n\n  if (!except.disabled && isDisabled(element)) {\n    return false;\n  }\n\n  if (!except.onlyTabbable && _isOnlyTabbable(element)) {\n    // some elements may be keyboard focusable, but not script focusable\n    return false;\n  }\n\n  // elements that are not rendered, cannot be focused\n  if (!except.visible) {\n    const visibilityOptions = {\n      context: element,\n      except: {},\n    };\n\n    if (supports.focusInHiddenIframe) {\n      // WebKit and Blink can focus content in hidden <iframe> and <object>\n      visibilityOptions.except.browsingContext = true;\n    }\n\n    if (supports.focusObjectSvgHidden) {\n      // Blink allows focusing the object element, even if it has visibility: hidden;\n      // @browser-issue Blink https://code.google.com/p/chromium/issues/detail?id=586191\n      const nodeName = element.nodeName.toLowerCase();\n      if (nodeName === 'object') {\n        visibilityOptions.except.cssVisibility = true;\n      }\n    }\n\n    if (!isVisible.rules(visibilityOptions)) {\n      return false;\n    }\n  }\n\n  const frameElement = getFrameElement(element);\n  if (frameElement) {\n    const _nodeName = frameElement.nodeName.toLowerCase();\n    if (_nodeName === 'object' && !supports.focusInZeroDimensionObject) {\n      if (!frameElement.offsetWidth || !frameElement.offsetHeight) {\n        // WebKit can not focus content in <object> if it doesn't have dimensions\n        return false;\n      }\n    }\n  }\n\n  const nodeName = element.nodeName.toLowerCase();\n  if (nodeName === 'svg' && supports.focusSvgInIframe && !frameElement && element.getAttribute('tabindex') === null) {\n    return false;\n  }\n\n  return true;\n}\n\n// bind exceptions to an iterator callback\nisFocusableRules.except = function(except = {}) {\n  const isFocusable = function(context) {\n    return isFocusableRules({\n      context,\n      except,\n    });\n  };\n\n  isFocusable.rules = isFocusableRules;\n  return isFocusable;\n};\n\n// provide isFocusRelevant(context) as default iterator callback\nconst isFocusable = isFocusableRules.except({});\nexport default isFocusable;\n"]}