{"version":3,"sources":["../../src/util/decorate-service.js"],"names":["engage","disengage","data","noop","instances","_result","initialize","bind","destruct","force"],"mappings":";;;;;;;;;;;;;;;;;;;oBAwCe,YAAmC;AAAA,oFAAJ,EAAI;AAAA,QAAzBA,MAAyB,SAAzBA,MAAyB;AAAA,QAAjBC,SAAiB,SAAjBA,SAAiB;;AAChD,QAAMC,OAAO;AACXF,cAAQA,UAAUG,IADP;AAEXF,iBAAWA,aAAaE,IAFb;AAGXC,iBAAW,CAHA;AAIXC,eAAS;AAJE,KAAb;;AAOA,WAAOC,WAAWC,IAAX,CAAgBL,IAAhB,CAAP;AACD,G;;AAhDD;;;;;;;;;;;AAWA,WAASM,QAAT,GAAgC;AAAA,mFAAJ,EAAI;AAAA,QAAbC,KAAa,QAAbA,KAAa;;AAC9B,QAAIA,KAAJ,EAAW;AACT,WAAKL,SAAL,GAAiB,CAAjB;AACD,KAFD,MAEO;AACL,WAAKA,SAAL;AACD;;AAED,QAAI,CAAC,KAAKA,SAAV,EAAqB;AACnB,WAAKH,SAAL;AACA,WAAKI,OAAL,GAAe,IAAf;AACD;AACF;;AAED,WAASC,UAAT,GAAsB;AACpB,QAAI,KAAKF,SAAT,EAAoB;AAClB,WAAKA,SAAL;AACA,aAAO,KAAKC,OAAZ;AACD;;AAED,SAAKD,SAAL;AACA,SAAKC,OAAL,GAAe,KAAKL,MAAL,MAAiB,EAAhC;AACA,SAAKK,OAAL,CAAaJ,SAAb,GAAyBO,SAASD,IAAT,CAAc,IAAd,CAAzB;;AAEA,WAAO,KAAKF,OAAZ;AACD;;AAED,WAASF,IAAT,GAAgB,CAAE","file":"decorate-service.js","sourcesContent":["\n/*\n  The Singleton Decorator is intended to allow modules to initialize a (\"singleton\") component as if\n  it was the only one using it. Every module gets to initialize and destruct the component by itself.\n  Via simple reference counting the component keeps track of how many modules have initialized it,\n  so it destructs only when the last module is gone. This decorator hides the component's singleton\n  nature from the application in order to offer a homogenous API.\n\n  engage() can return an object (result) with methods to expose to the consumer,\n  upon initialization result.disengage is added and returned to the consumer.\n*/\n\nfunction destruct({force} = {}) {\n  if (force) {\n    this.instances = 0;\n  } else {\n    this.instances--;\n  }\n\n  if (!this.instances) {\n    this.disengage();\n    this._result = null;\n  }\n}\n\nfunction initialize() {\n  if (this.instances) {\n    this.instances++;\n    return this._result;\n  }\n\n  this.instances++;\n  this._result = this.engage() || {};\n  this._result.disengage = destruct.bind(this);\n\n  return this._result;\n}\n\nfunction noop() {}\n\nexport default function({engage, disengage} = {}) {\n  const data = {\n    engage: engage || noop,\n    disengage: disengage || noop,\n    instances: 0,\n    _result: null,\n  };\n\n  return initialize.bind(data);\n}\n"]}