{"version":3,"sources":["../../src/get/focus-redirect-target.js"],"names":["context","skipFocusable","supports","element","label","nodeName","toLowerCase","_document","resolveLabelElement","resolveLegendElement","resolveImgElement","formControlElement","forId","getAttribute","getElementById","querySelector","resolveLegendWithinFieldset","fieldset","parentNode","focusable","strategy","filter","resolveLegendWithinDocument","tabbable","body","length","merged","list","elements","offset","indexOf","focusRedirectLegend","focusRedirectImgUsemap","map"],"mappings":"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","file":"focus-redirect-target.js","sourcesContent":["\nimport isFocusable from '../is/focusable';\nimport queryFocusable from '../query/focusable';\nimport queryTabbable from '../query/tabbable';\nimport contextToElement from '../util/context-to-element';\nimport getDocument from '../util/get-document';\nimport mergeInDomOrder from '../util/merge-dom-order';\nimport {getMapOfImage} from '../util/image-map';\n\nimport _supports from '../supports/supports';\nlet supports;\n\nfunction formControlElement(element) {\n  const nodeName = element.nodeName.toLowerCase();\n  return nodeName === 'input'\n    || nodeName === 'textarea'\n    || nodeName === 'select'\n    || nodeName === 'button';\n}\n\nfunction resolveLabelElement(element, _document) {\n  const forId = element.getAttribute('for');\n  if (forId) {\n    // <label for=\"…\"> - referenced form control\n    return _document.getElementById(forId);\n  }\n\n  // <label><input - nested form control\n  return element.querySelector('input, select, textarea');\n}\n\nfunction resolveLegendWithinFieldset(element) {\n  // Chrome: first focusable input/select/textarea/button within <fieldset>\n  const fieldset = element.parentNode;\n  const focusable = queryFocusable({\n    context: fieldset,\n    strategy: 'strict',\n  });\n\n  return focusable.filter(formControlElement)[0] || null;\n}\n\nfunction resolveLegendWithinDocument(element, _document) {\n  // Firefox: *next* tabbable (in DOM order)\n  const tabbable = queryTabbable({\n    // Firefox apparently needs to query from the body element,\n    // not the document, looking inside a dynamically written iframe\n    context: _document.body,\n    strategy: 'strict',\n  });\n\n  if (!tabbable.length) {\n    return null;\n  }\n\n  // sort <legend> into the list of tabbable elements\n  // so that we can identify the next element\n  const merged = mergeInDomOrder({\n    list: tabbable,\n    elements: [element],\n  });\n\n  const offset = merged.indexOf(element);\n  if (offset === merged.length - 1) {\n    return null;\n  }\n\n  return merged[offset + 1];\n}\n\nfunction resolveLegendElement(element, _document) {\n  // <legend> - first <input> in <fieldset>\n  if (!supports.focusRedirectLegend) {\n    return null;\n  }\n\n  // legend must be the first child of a <fieldset>\n  const fieldset = element.parentNode;\n  if (fieldset.nodeName.toLowerCase() !== 'fieldset') {\n    return null;\n  }\n\n  if (supports.focusRedirectLegend === 'tabbable') {\n    // Firefox goes for *next* tabbable (in DOM order)\n    return resolveLegendWithinDocument(element, _document);\n  }\n\n  // Chrome goes for first focusable input/select/textarea/button within <fieldset>\n  return resolveLegendWithinFieldset(element, _document);\n}\n\nfunction resolveImgElement(element) {\n  if (!supports.focusRedirectImgUsemap) {\n    return null;\n  }\n\n  // IE9-11: <img usemap=\"#…\" src=\"…\"> - first <area>\n  const map = getMapOfImage(element);\n  return map && map.querySelector('area') || null;\n}\n\nexport default function({context, skipFocusable} = {}) {\n  if (!supports) {\n    supports = _supports();\n  }\n\n  const element = contextToElement({\n    label: 'get/focus-redirect-target',\n    context,\n  });\n\n  if (!skipFocusable && isFocusable(element)) {\n    return null;\n  }\n\n  const nodeName = element.nodeName.toLowerCase();\n  const _document = getDocument(element);\n\n  if (nodeName === 'label') {\n    return resolveLabelElement(element, _document);\n  }\n\n  if (nodeName === 'legend') {\n    return resolveLegendElement(element, _document);\n  }\n\n  if (nodeName === 'img') {\n    return resolveImgElement(element, _document);\n  }\n\n  return null;\n}\n\n"]}