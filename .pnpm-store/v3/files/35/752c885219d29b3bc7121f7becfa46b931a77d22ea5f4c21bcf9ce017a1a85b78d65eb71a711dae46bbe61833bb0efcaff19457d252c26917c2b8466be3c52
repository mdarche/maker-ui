{"version":3,"sources":["../../src/query/tabsequence.js"],"names":["context","includeContext","includeOnlyTabbable","strategy","supports","_context","document","documentElement","elements","body","createShadowRoot","is","BLINK","sortElements","moveContextToBeginning","pos","indexOf","tmp","splice","concat","tabsequenceAreaAtImgPosition"],"mappings":";;;;;;;;;;;;;;;;;;;oBAmCe,YAKP;AAAA,mFAAJ,EAAI;AAAA,QAJNA,OAIM,QAJNA,OAIM;AAAA,QAHNC,cAGM,QAHNA,cAGM;AAAA,QAFNC,mBAEM,QAFNA,mBAEM;AAAA,QADNC,QACM,QADNA,QACM;;AACN,QAAI,CAACC,QAAL,EAAe;AACbA,iBAAW,yBAAX;AACD;;AAED,QAAMC,WAAW,yBAAUL,OAAV,EAAmB,CAAnB,KAAyBM,SAASC,eAAnD;AACA,QAAIC,WAAW,wBAAc;AAC3BR,eAASK,QADkB;AAE3BJ,oCAF2B;AAG3BC,8CAH2B;AAI3BC;AAJ2B,KAAd,CAAf;;AAOA,QAAIG,SAASG,IAAT,CAAcC,gBAAd,IAAkC,mBAASC,EAAT,CAAYC,KAAlD,EAAyD;AACvD;AACA;AACAJ,iBAAW,2BAAaA,QAAb,EAAuBH,QAAvB,EAAiCQ,YAAjC,CAAX;AACD,KAJD,MAIO;AACLL,iBAAWK,aAAaL,QAAb,EAAuBH,QAAvB,CAAX;AACD;;AAED,QAAIJ,cAAJ,EAAoB;AAClB;AACA;AACAO,iBAAWM,uBAAuBN,QAAvB,EAAiCH,QAAjC,CAAX;AACD;;AAED,WAAOG,QAAP;AACD,G;;;;;;;;;;;;;;;;;;;;;;AAzDD,MAAIJ,iBAAJ;AAVA;AACA;;AAWA,WAASU,sBAAT,CAAgCN,QAAhC,EAA0CR,OAA1C,EAAmD;AACjD,QAAMe,MAAMP,SAASQ,OAAT,CAAiBhB,OAAjB,CAAZ;AACA,QAAIe,MAAM,CAAV,EAAa;AACX,UAAME,MAAMT,SAASU,MAAT,CAAgBH,GAAhB,EAAqB,CAArB,CAAZ;AACA,aAAOE,IAAIE,MAAJ,CAAWX,QAAX,CAAP;AACD;;AAED,WAAOA,QAAP;AACD;;AAED,WAASK,YAAT,CAAsBL,QAAtB,EAAgCH,QAAhC,EAA0C;AACxC,QAAID,SAASgB,4BAAb,EAA2C;AACzC;AACA;AACA;AACAZ,iBAAW,2BAASA,QAAT,EAAmBH,QAAnB,CAAX;AACD;;AAEDG,eAAW,2BAAaA,QAAb,CAAX;AACA,WAAOA,QAAP;AACD","file":"tabsequence.js","sourcesContent":["\n// https://www.w3.org/TR/html5/editing.html#sequential-focus-navigation-and-the-tabindex-attribute\n// https://www.w3.org/WAI/PF/aria-practices/#keyboard\n\nimport queryTabbable from './tabbable';\nimport nodeArray from '../util/node-array';\nimport platform from '../util/platform';\nimport sortArea from './tabsequence.sort-area';\nimport sortShadowed from './tabsequence.sort-shadowed';\nimport sortTabindex from './tabsequence.sort-tabindex';\nimport _supports from '../supports/supports';\nlet supports;\n\nfunction moveContextToBeginning(elements, context) {\n  const pos = elements.indexOf(context);\n  if (pos > 0) {\n    const tmp = elements.splice(pos, 1);\n    return tmp.concat(elements);\n  }\n\n  return elements;\n}\n\nfunction sortElements(elements, _context) {\n  if (supports.tabsequenceAreaAtImgPosition) {\n    // Some browsers sort <area> in DOM order, some place the <area>s\n    // where the <img> referecing them would've been in DOM order.\n    // https://github.com/medialize/ally.js/issues/5\n    elements = sortArea(elements, _context);\n  }\n\n  elements = sortTabindex(elements);\n  return elements;\n}\n\nexport default function({\n  context,\n  includeContext,\n  includeOnlyTabbable,\n  strategy,\n} = {}) {\n  if (!supports) {\n    supports = _supports();\n  }\n\n  const _context = nodeArray(context)[0] || document.documentElement;\n  let elements = queryTabbable({\n    context: _context,\n    includeContext,\n    includeOnlyTabbable,\n    strategy,\n  });\n\n  if (document.body.createShadowRoot && platform.is.BLINK) {\n    // sort tabindex localized to shadow dom\n    // see https://github.com/medialize/ally.js/issues/6\n    elements = sortShadowed(elements, _context, sortElements);\n  } else {\n    elements = sortElements(elements, _context);\n  }\n\n  if (includeContext) {\n    // if we include the context itself, it has to be the first\n    // element of the sequence\n    elements = moveContextToBeginning(elements, _context);\n  }\n\n  return elements;\n}\n"]}