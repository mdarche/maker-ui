{"version":3,"sources":["../../src/supports/detect-focus.js"],"names":["tests","data","before","results","Object","keys","map","key","test","after","activeElement","document","windowScrollTop","window","scrollTop","windowScrollLeft","scrollLeft","bodyScrollTop","body","bodyScrollLeft","iframe","createElement","setAttribute","appendChild","_window","contentWindow","_document","open","close","wrapper","options","innerHTML","element","focus","mutate","parentNode","validate","blur","is","IE10","removeChild"],"mappings":";;;;;;kBA2Fe,UAASA,KAAT,EAAgB;AAC7B,MAAMC,OAAOC,QAAb;;AAEA,MAAMC,UAAU,EAAhB;AACAC,SAAOC,IAAP,CAAYL,KAAZ,EAAmBM,GAAnB,CAAuB,UAASC,GAAT,EAAc;AACnCJ,YAAQI,GAAR,IAAeC,KAAKP,IAAL,EAAWD,MAAMO,GAAN,CAAX,CAAf;AACD,GAFD;;AAIAE,QAAMR,IAAN;AACA,SAAOE,OAAP;AACD,C;;AApGD;;;;;;AAEA,SAASD,MAAT,GAAkB;AAChB,MAAMD,OAAO;AACX;AACAS,mBAAeC,SAASD,aAFb;AAGX;AACAE,qBAAiBC,OAAOC,SAJb;AAKXC,sBAAkBF,OAAOG,UALd;AAMXC,mBAAeN,SAASO,IAAT,CAAcJ,SANlB;AAOXK,oBAAgBR,SAASO,IAAT,CAAcF;AAPnB,GAAb;;AAUA;AACA;AACA,MAAMI,SAAST,SAASU,aAAT,CAAuB,QAAvB,CAAf;AACAD,SAAOE,YAAP,CAAoB,OAApB,EAA6B,8FAA7B;AACAF,SAAOE,YAAP,CAAoB,WAApB,EAAiC,KAAjC;AACAF,SAAOE,YAAP,CAAoB,WAApB,EAAiC,MAAjC;AACAF,SAAOE,YAAP,CAAoB,aAApB,EAAmC,MAAnC;AACAX,WAASO,IAAT,CAAcK,WAAd,CAA0BH,MAA1B;;AAEA,MAAMI,UAAUJ,OAAOK,aAAvB;AACA,MAAMC,YAAYF,QAAQb,QAA1B;;AAEAe,YAAUC,IAAV;AACAD,YAAUE,KAAV;AACA,MAAMC,UAAUH,UAAUL,aAAV,CAAwB,KAAxB,CAAhB;AACAK,YAAUR,IAAV,CAAeK,WAAf,CAA2BM,OAA3B;;AAEA5B,OAAKmB,MAAL,GAAcA,MAAd;AACAnB,OAAK4B,OAAL,GAAeA,OAAf;AACA5B,OAAKY,MAAL,GAAcW,OAAd;AACAvB,OAAKU,QAAL,GAAgBe,SAAhB;;AAEA,SAAOzB,IAAP;AACD;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASO,IAAT,CAAcP,IAAd,EAAoB6B,OAApB,EAA6B;AAC3B;AACA7B,OAAK4B,OAAL,CAAaE,SAAb,GAAyB,EAAzB;AACA;AACA,MAAMC,UAAU,OAAOF,QAAQE,OAAf,KAA2B,QAA3B,GACZ/B,KAAKU,QAAL,CAAcU,aAAd,CAA4BS,QAAQE,OAApC,CADY,GAEZF,QAAQE,OAAR,CAAgB/B,KAAK4B,OAArB,EAA8B5B,KAAKU,QAAnC,CAFJ;AAGA;AACA;AACA,MAAIsB,QAAQH,QAAQI,MAAR,IAAkBJ,QAAQI,MAAR,CAAeF,OAAf,EAAwB/B,KAAK4B,OAA7B,EAAsC5B,KAAKU,QAA3C,CAA9B;AACA,MAAI,CAACsB,KAAD,IAAUA,UAAU,KAAxB,EAA+B;AAC7BA,YAAQD,OAAR;AACD;AACD;AACA,GAACA,QAAQG,UAAT,IAAuBlC,KAAK4B,OAAL,CAAaN,WAAb,CAAyBS,OAAzB,CAAvB;AACA;AACAC,WAASA,MAAMA,KAAf,IAAwBA,MAAMA,KAAN,EAAxB;AACA;AACA,SAAOH,QAAQM,QAAR,GACHN,QAAQM,QAAR,CAAiBJ,OAAjB,EAA0BC,KAA1B,EAAiChC,KAAKU,QAAtC,CADG,GAEHV,KAAKU,QAAL,CAAcD,aAAd,KAAgCuB,KAFpC;AAGD;;AAED,SAASxB,KAAT,CAAeR,IAAf,EAAqB;AACnB;AACA,MAAIA,KAAKS,aAAL,KAAuBC,SAASO,IAApC,EAA0C;AACxCP,aAASD,aAAT,IAA0BC,SAASD,aAAT,CAAuB2B,IAAjD,IAAyD1B,SAASD,aAAT,CAAuB2B,IAAvB,EAAzD;AACA,QAAI,mBAASC,EAAT,CAAYC,IAAhB,EAAsB;AACpB;AACA5B,eAASO,IAAT,CAAce,KAAd;AACD;AACF,GAND,MAMO;AACLhC,SAAKS,aAAL,IAAsBT,KAAKS,aAAL,CAAmBuB,KAAzC,IAAkDhC,KAAKS,aAAL,CAAmBuB,KAAnB,EAAlD;AACD;;AAEDtB,WAASO,IAAT,CAAcsB,WAAd,CAA0BvC,KAAKmB,MAA/B;;AAEA;AACAP,SAAOC,SAAP,GAAmBb,KAAKW,eAAxB;AACAC,SAAOG,UAAP,GAAoBf,KAAKc,gBAAzB;AACAJ,WAASO,IAAT,CAAcJ,SAAd,GAA0Bb,KAAKgB,aAA/B;AACAN,WAASO,IAAT,CAAcF,UAAd,GAA2Bf,KAAKkB,cAAhC;AACD","file":"detect-focus.js","sourcesContent":["\nimport platform from '../util/platform';\n\nfunction before() {\n  const data = {\n    // remember what had focus to restore after test\n    activeElement: document.activeElement,\n    // remember scroll positions to restore after test\n    windowScrollTop: window.scrollTop,\n    windowScrollLeft: window.scrollLeft,\n    bodyScrollTop: document.body.scrollTop,\n    bodyScrollLeft: document.body.scrollLeft,\n  };\n\n  // wrap tests in an element hidden from screen readers to prevent them\n  // from announcing focus, which can be quite irritating to the user\n  const iframe = document.createElement('iframe');\n  iframe.setAttribute('style', 'position:absolute; position:fixed; top:0; left:-2px; width:1px; height:1px; overflow:hidden;');\n  iframe.setAttribute('aria-live', 'off');\n  iframe.setAttribute('aria-busy', 'true');\n  iframe.setAttribute('aria-hidden', 'true');\n  document.body.appendChild(iframe);\n\n  const _window = iframe.contentWindow;\n  const _document = _window.document;\n\n  _document.open();\n  _document.close();\n  const wrapper = _document.createElement('div');\n  _document.body.appendChild(wrapper);\n\n  data.iframe = iframe;\n  data.wrapper = wrapper;\n  data.window = _window;\n  data.document = _document;\n\n  return data;\n}\n\n// options.element:\n//  {string} element name\n//  {function} callback(wrapper, document) to generate an element\n// options.mutate: (optional)\n//  {function} callback(element, wrapper, document) to manipulate element prior to focus-test.\n//             Can return DOMElement to define focus target (default: element)\n// options.validate: (optional)\n//  {function} callback(element, focusTarget, document) to manipulate test-result\nfunction test(data, options) {\n  // make sure we operate on a clean slate\n  data.wrapper.innerHTML = '';\n  // create dummy element to test focusability of\n  const element = typeof options.element === 'string'\n    ? data.document.createElement(options.element)\n    : options.element(data.wrapper, data.document);\n  // allow callback to further specify dummy element\n  // and optionally define element to focus\n  let focus = options.mutate && options.mutate(element, data.wrapper, data.document);\n  if (!focus && focus !== false) {\n    focus = element;\n  }\n  // element needs to be part of the DOM to be focusable\n  !element.parentNode && data.wrapper.appendChild(element);\n  // test if the element with invalid tabindex can be focused\n  focus && focus.focus && focus.focus();\n  // validate test's result\n  return options.validate\n    ? options.validate(element, focus, data.document)\n    : data.document.activeElement === focus;\n}\n\nfunction after(data) {\n  // restore focus to what it was before test and cleanup\n  if (data.activeElement === document.body) {\n    document.activeElement && document.activeElement.blur && document.activeElement.blur();\n    if (platform.is.IE10) {\n      // IE10 does not redirect focus to <body> when the activeElement is removed\n      document.body.focus();\n    }\n  } else {\n    data.activeElement && data.activeElement.focus && data.activeElement.focus();\n  }\n\n  document.body.removeChild(data.iframe);\n\n  // restore scroll position\n  window.scrollTop = data.windowScrollTop;\n  window.scrollLeft = data.windowScrollLeft;\n  document.body.scrollTop = data.bodyScrollTop;\n  document.body.scrollLeft = data.bodyScrollLeft;\n}\n\nexport default function(tests) {\n  const data = before();\n\n  const results = {};\n  Object.keys(tests).map(function(key) {\n    results[key] = test(data, tests[key]);\n  });\n\n  after(data);\n  return results;\n}\n"]}