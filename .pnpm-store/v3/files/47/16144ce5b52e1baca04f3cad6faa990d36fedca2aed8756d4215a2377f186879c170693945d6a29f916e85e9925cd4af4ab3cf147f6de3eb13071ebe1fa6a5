{"version":3,"sources":["../../src/style/focus-source.js"],"names":["supportsFocusIn","document","focusEventName","blurEventName","interactionTypeHandler","shadowHandle","current","lock","used","pointer","key","script","initial","handleFocusEvent","event","source","type","interactionType","get","documentElement","setAttribute","getCurrentFocusSource","getUsedFocusSource","lockFocusSource","unlockFocusSource","disengage","Object","keys","forEach","removeEventListener","removeAttribute","engage","addEventListener","unlock"],"mappings":"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","file":"focus-source.js","sourcesContent":["\n/*\n  add data-focus-source attribute to html element containing \"key\", \"pointer\" or \"script\"\n  depending on the input method used to change focus.\n\n  USAGE:\n    style/focus-source()\n\n    body :focus {\n      outline: 1px solid grey;\n    }\n\n    html[data-focus-source=\"key\"] body :focus {\n      outline: 5px solid red;\n    }\n\n    html[data-focus-source=\"key\"] body :focus {\n      outline: 1px solid blue;\n    }\n\n  NOTE: I don't have a GamePad to test, if you do and you want to\n  implement an observer for https://w3c.github.io/gamepad/ - send a PR!\n\n  Alternate implementation: https://github.com/alice/modality\n*/\n\nimport { addClass, removeClass } from '../util/toggle-class';\nimport shadowFocus from '../event/shadow-focus';\nimport engageInteractionTypeObserver from '../observe/interaction-type';\nimport decorateService from '../util/decorate-service';\n\n// preferring focusin/out because they are synchronous in IE10+11\nconst supportsFocusIn = typeof document !== 'undefined' && 'onfocusin' in document;\nconst focusEventName = supportsFocusIn ? 'focusin' : 'focus';\nconst blurEventName = supportsFocusIn ? 'focusout' : 'blur';\n\n// interface to read interaction-type-listener state\nlet interactionTypeHandler;\nlet shadowHandle;\n// keep track of last focus source\nlet current = null;\n// overwrite focus source for use with the every upcoming focus event\nlet lock = null;\n// keep track of ever having used a particular input method to change focus\nconst used = {\n  pointer: false,\n  key: false,\n  script: false,\n  initial: false,\n};\n\nfunction handleFocusEvent(event) {\n  let source = '';\n  if (event.type === focusEventName || event.type === 'shadow-focus') {\n    const interactionType = interactionTypeHandler.get();\n    source = lock\n      || interactionType.pointer && 'pointer'\n      || interactionType.key && 'key'\n      || 'script';\n  } else if (event.type === 'initial') {\n    source = 'initial';\n  }\n\n  document.documentElement.setAttribute('data-focus-source', source);\n\n  if (event.type !== blurEventName) {\n    if (!used[source]) {\n      addClass(document.documentElement, 'focus-source-' + source);\n    }\n\n    used[source] = true;\n    current = source;\n  }\n}\n\nfunction getCurrentFocusSource() {\n  return current;\n}\n\nfunction getUsedFocusSource(source) {\n  return used[source];\n}\n\nfunction lockFocusSource(source) {\n  lock = source;\n}\n\nfunction unlockFocusSource() {\n  lock = false;\n}\n\nfunction disengage() {\n  // clear dom state\n  handleFocusEvent({type: blurEventName});\n  current = lock = null;\n  Object.keys(used).forEach(function(key) {\n    removeClass(document.documentElement, 'focus-source-' + key);\n    used[key] = false;\n  });\n  // kill interaction type identification listener\n  interactionTypeHandler.disengage();\n  // kill shadow-focus event dispatcher\n  shadowHandle && shadowHandle.disengage();\n  document.removeEventListener('shadow-focus', handleFocusEvent, true);\n  document.documentElement.removeEventListener(focusEventName, handleFocusEvent, true);\n  document.documentElement.removeEventListener(blurEventName, handleFocusEvent, true);\n  document.documentElement.removeAttribute('data-focus-source');\n}\n\nfunction engage() {\n  // enable the shadow-focus event dispatcher\n  shadowHandle = shadowFocus();\n  // handlers to modify the focused element\n  document.addEventListener('shadow-focus', handleFocusEvent, true);\n  document.documentElement.addEventListener(focusEventName, handleFocusEvent, true);\n  document.documentElement.addEventListener(blurEventName, handleFocusEvent, true);\n  // enable the interaction type identification observer\n  interactionTypeHandler = engageInteractionTypeObserver();\n  // set up initial dom state\n  handleFocusEvent({type: 'initial'});\n\n  return {\n    used: getUsedFocusSource,\n    current: getCurrentFocusSource,\n    lock: lockFocusSource,\n    unlock: unlockFocusSource,\n  };\n}\n\nexport default decorateService({ engage, disengage });\n"]}