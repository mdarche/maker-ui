{"version":3,"sources":["../../src/maintain/tab-focus.js"],"names":["context","document","documentElement","event","preventDefault","sequence","backward","shiftKey","first","last","length","source","target","focus","currentIndex","found","some","element","index","offset"],"mappings":";;;;;;kBAKe,YAA2B;AAAA,iFAAJ,EAAI;AAAA,MAAhBA,OAAgB,QAAhBA,OAAgB;;AACxC,MAAI,CAACA,OAAL,EAAc;AACZA,cAAUC,SAASC,eAAnB;AACD;;AAED;AACA;AACA;AACA;;AAEA,SAAO,mBAAQ;AACb;AACA;AACA,uBAAmB,qBAASC,KAAT,EAAgB;AACjC;AACAA,YAAMC,cAAN;;AAEA,UAAMC,WAAW,2BAAiB;AAChCL;AADgC,OAAjB,CAAjB;;AAIA,UAAMM,WAAWH,MAAMI,QAAvB;AACA,UAAMC,QAAQH,SAAS,CAAT,CAAd;AACA,UAAMI,OAAOJ,SAASA,SAASK,MAAT,GAAkB,CAA3B,CAAb;;AAEA;AACA,UAAMC,SAASL,WAAWE,KAAX,GAAmBC,IAAlC;AACA,UAAMG,SAASN,WAAWG,IAAX,GAAkBD,KAAjC;AACA,UAAI,6BAAgBG,MAAhB,CAAJ,EAA6B;AAC3BC,eAAOC,KAAP;AACA;AACD;;AAED;AACA,UAAIC,qBAAJ;AACA,UAAMC,QAAQV,SAASW,IAAT,CAAc,UAASC,OAAT,EAAkBC,KAAlB,EAAyB;AACnD,YAAI,CAAC,6BAAgBD,OAAhB,CAAL,EAA+B;AAC7B,iBAAO,KAAP;AACD;;AAEDH,uBAAeI,KAAf;AACA,eAAO,IAAP;AACD,OAPa,CAAd;;AASA,UAAI,CAACH,KAAL,EAAY;AACV;AACAP,cAAMK,KAAN;AACA;AACD;;AAED;AACA,UAAMM,SAASb,WAAW,CAAC,CAAZ,GAAgB,CAA/B;AACAD,eAASS,eAAeK,MAAxB,EAAgCN,KAAhC;AACD;AA3CY,GAAR,CAAP;AA6CD,C;;AA3DD;;;;AACA;;;;AACA","file":"tab-focus.js","sourcesContent":["\nimport isActiveElement from '../is/active-element';\nimport queryTabsequence from '../query/tabsequence';\nimport whenKey from '../when/key';\n\nexport default function({ context } = {}) {\n  if (!context) {\n    context = document.documentElement;\n  }\n\n  // Make sure the supports tests are run before intercepting the Tab key,\n  // or IE10 and IE11 will fail to process the first Tab key event. Not\n  // limiting this warm-up to IE because it may be a problem elsewhere, too.\n  queryTabsequence();\n\n  return whenKey({\n    // Safari on OSX may require ALT+TAB to reach links,\n    // see https://github.com/medialize/ally.js/issues/146\n    '?alt+?shift+tab': function(event) {\n      // we're completely taking over the Tab key handling\n      event.preventDefault();\n\n      const sequence = queryTabsequence({\n        context,\n      });\n\n      const backward = event.shiftKey;\n      const first = sequence[0];\n      const last = sequence[sequence.length - 1];\n\n      // wrap around first to last, last to first\n      const source = backward ? first : last;\n      const target = backward ? last : first;\n      if (isActiveElement(source)) {\n        target.focus();\n        return;\n      }\n\n      // find current position in tabsequence\n      let currentIndex;\n      const found = sequence.some(function(element, index) {\n        if (!isActiveElement(element)) {\n          return false;\n        }\n\n        currentIndex = index;\n        return true;\n      });\n\n      if (!found) {\n        // redirect to first as we're not in our tabsequence\n        first.focus();\n        return;\n      }\n\n      // shift focus to previous/next element in the sequence\n      const offset = backward ? -1 : 1;\n      sequence[currentIndex + offset].focus();\n    },\n  });\n}\n"]}