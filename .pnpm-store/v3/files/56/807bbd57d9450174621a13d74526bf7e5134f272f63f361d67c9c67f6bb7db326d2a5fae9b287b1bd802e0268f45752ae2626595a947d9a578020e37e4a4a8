{"version":3,"sources":["../../src/get/focus-redirect-target.js"],"names":["context","skipFocusable","supports","element","label","nodeName","toLowerCase","_document","resolveLabelElement","resolveLegendElement","resolveImgElement","formControlElement","forId","getAttribute","getElementById","querySelector","resolveLegendWithinFieldset","fieldset","parentNode","focusable","strategy","filter","resolveLegendWithinDocument","tabbable","body","length","merged","list","elements","offset","indexOf","focusRedirectLegend","focusRedirectImgUsemap","map"],"mappings":"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","file":"focus-redirect-target.js","sourcesContent":["\nimport isFocusable from '../is/focusable';\nimport queryFocusable from '../query/focusable';\nimport queryTabbable from '../query/tabbable';\nimport contextToElement from '../util/context-to-element';\nimport getDocument from '../util/get-document';\nimport mergeInDomOrder from '../util/merge-dom-order';\nimport {getMapOfImage} from '../util/image-map';\n\nimport _supports from '../supports/supports';\nlet supports;\n\nfunction formControlElement(element) {\n  const nodeName = element.nodeName.toLowerCase();\n  return nodeName === 'input'\n    || nodeName === 'textarea'\n    || nodeName === 'select'\n    || nodeName === 'button';\n}\n\nfunction resolveLabelElement(element, _document) {\n  const forId = element.getAttribute('for');\n  if (forId) {\n    // <label for=\"…\"> - referenced form control\n    return _document.getElementById(forId);\n  }\n\n  // <label><input - nested form control\n  return element.querySelector('input, select, textarea');\n}\n\nfunction resolveLegendWithinFieldset(element) {\n  // Chrome: first focusable input/select/textarea/button within <fieldset>\n  const fieldset = element.parentNode;\n  const focusable = queryFocusable({\n    context: fieldset,\n    strategy: 'strict',\n  });\n\n  return focusable.filter(formControlElement)[0] || null;\n}\n\nfunction resolveLegendWithinDocument(element, _document) {\n  // Firefox: *next* tabbable (in DOM order)\n  const tabbable = queryTabbable({\n    // Firefox apparently needs to query from the body element,\n    // not the document, looking inside a dynamically written iframe\n    context: _document.body,\n    strategy: 'strict',\n  });\n\n  if (!tabbable.length) {\n    return null;\n  }\n\n  // sort <legend> into the list of tabbable elements\n  // so that we can identify the next element\n  const merged = mergeInDomOrder({\n    list: tabbable,\n    elements: [element],\n  });\n\n  const offset = merged.indexOf(element);\n  if (offset === merged.length - 1) {\n    return null;\n  }\n\n  return merged[offset + 1];\n}\n\nfunction resolveLegendElement(element, _document) {\n  // <legend> - first <input> in <fieldset>\n  if (!supports.focusRedirectLegend) {\n    return null;\n  }\n\n  // legend must be the first child of a <fieldset>\n  const fieldset = element.parentNode;\n  if (fieldset.nodeName.toLowerCase() !== 'fieldset') {\n    return null;\n  }\n\n  if (supports.focusRedirectLegend === 'tabbable') {\n    // Firefox goes for *next* tabbable (in DOM order)\n    return resolveLegendWithinDocument(element, _document);\n  }\n\n  // Chrome goes for first focusable input/select/textarea/button within <fieldset>\n  return resolveLegendWithinFieldset(element, _document);\n}\n\nfunction resolveImgElement(element) {\n  if (!supports.focusRedirectImgUsemap) {\n    return null;\n  }\n\n  // IE9-11: <img usemap=\"#…\" src=\"…\"> - first <area>\n  const map = getMapOfImage(element);\n  return map && map.querySelector('area') || null;\n}\n\nexport default function({context, skipFocusable} = {}) {\n  if (!supports) {\n    supports = _supports();\n  }\n\n  const element = contextToElement({\n    label: 'get/focus-redirect-target',\n    context,\n  });\n\n  if (!skipFocusable && isFocusable(element)) {\n    return null;\n  }\n\n  const nodeName = element.nodeName.toLowerCase();\n  const _document = getDocument(element);\n\n  if (nodeName === 'label') {\n    return resolveLabelElement(element, _document);\n  }\n\n  if (nodeName === 'legend') {\n    return resolveLegendElement(element, _document);\n  }\n\n  if (nodeName === 'img') {\n    return resolveImgElement(element, _document);\n  }\n\n  return null;\n}\n\n"]}