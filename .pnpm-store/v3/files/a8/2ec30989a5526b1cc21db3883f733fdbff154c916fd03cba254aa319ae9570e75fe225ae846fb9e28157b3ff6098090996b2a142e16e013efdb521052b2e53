{"version":3,"sources":["../../src/get/insignificant-branches.js"],"names":["contextToElement","nodeArray","getParentComparator","getDocument","queryInsignificantBranches","context","filter","containsFilteredElement","node","containsNode","parent","some","insiginificantBranches","CollectInsignificantBranchesFilter","element","NodeFilter","FILTER_REJECT","FILTER_ACCEPT","push","acceptNode","_document","walker","createTreeWalker","SHOW_ELEMENT","nextNode","label","defaultToDocument","length","TypeError"],"mappings":";AACA;AACA;AACA;AACA;AACA;;AAEA,OAAOA,gBAAP,MAA6B,4BAA7B;AACA,OAAOC,SAAP,MAAsB,oBAAtB;AACA,SAAQC,mBAAR,QAAkC,0BAAlC;AACA,OAAOC,WAAP,MAAwB,sBAAxB;;AAEA,SAASC,0BAAT,OAAuD;AAAA,MAAlBC,OAAkB,QAAlBA,OAAkB;AAAA,MAATC,MAAS,QAATA,MAAS;;AACrD,MAAMC,0BAA0B,SAA1BA,uBAA0B,CAASC,IAAT,EAAe;AAC7C,QAAMC,eAAeP,oBAAoB,EAACQ,QAAQF,IAAT,EAApB,CAArB;AACA,WAAOF,OAAOK,IAAP,CAAYF,YAAZ,CAAP;AACD,GAHD;;AAKA;AACA,MAAMG,yBAAyB,EAA/B;;AAEA;AACA,MAAMC,qCAAqC,SAArCA,kCAAqC,CAASL,IAAT,EAAe;AACxD,QAAIF,OAAOK,IAAP,CAAY;AAAA,aAAWH,SAASM,OAApB;AAAA,KAAZ,CAAJ,EAA8C;AAC5C;AACA,aAAOC,WAAWC,aAAlB;AACD;;AAED,QAAIT,wBAAwBC,IAAxB,CAAJ,EAAmC;AACjC;AACA,aAAOO,WAAWE,aAAlB;AACD;;AAED;AACAL,2BAAuBM,IAAvB,CAA4BV,IAA5B;AACA,WAAOO,WAAWC,aAAlB;AACD,GAdD;AAeA;AACA;AACAH,qCAAmCM,UAAnC,GAAgDN,kCAAhD;;AAEA,MAAMO,YAAYjB,YAAYE,OAAZ,CAAlB;AACA;AACA,MAAMgB,SAASD,UAAUE,gBAAV;AACb;AACAjB,SAFa;AAGb;AACAU,aAAWQ,YAJE;AAKb;AACAV,oCANa;AAOb;AACA,OARa,CAAf;;AAWA,SAAOQ,OAAOG,QAAP,EAAP,EAA0B;AACxB;AACD;;AAED,SAAOZ,sBAAP;AACD;;AAED,eAAe,YAAiC;AAAA,kFAAJ,EAAI;AAAA,MAAvBP,OAAuB,SAAvBA,OAAuB;AAAA,MAAdC,MAAc,SAAdA,MAAc;;AAC9CD,YAAUL,iBAAiB;AACzByB,WAAO,4BADkB;AAEzBC,uBAAmB,IAFM;AAGzBrB;AAHyB,GAAjB,CAAV;;AAMAC,WAASL,UAAUK,MAAV,CAAT;AACA,MAAI,CAACA,OAAOqB,MAAZ,EAAoB;AAClB,UAAM,IAAIC,SAAJ,CAAc,0DAAd,CAAN;AACD;;AAED,SAAOxB,2BAA2B;AAChCC,oBADgC;AAEhCC;AAFgC,GAA3B,CAAP;AAID","file":"insignificant-branches.js","sourcesContent":["\n// find all highest elements within context that do not contain any of the filter elements.\n// (basically the tree minus the parent paths of each filtered element reduced to the top most nodes)\n// originally inspired by Marcy Sutton's Material Dialog Component:\n// https://github.com/angular/material/blob/v0.11.1/src/components/dialog/dialog.js#L748-L783\n// to avoid this behavior: https://marcysutton.com/slides/mobile-a11y-seattlejs/#/36\n\nimport contextToElement from '../util/context-to-element';\nimport nodeArray from '../util/node-array';\nimport {getParentComparator} from '../util/compare-position';\nimport getDocument from '../util/get-document';\n\nfunction queryInsignificantBranches({context, filter}) {\n  const containsFilteredElement = function(node) {\n    const containsNode = getParentComparator({parent: node});\n    return filter.some(containsNode);\n  };\n\n  // We'd use a Set() for this, if we could\n  const insiginificantBranches = [];\n\n  // see https://developer.mozilla.org/en-US/docs/Web/API/NodeFilter\n  const CollectInsignificantBranchesFilter = function(node) {\n    if (filter.some(element => node === element)) {\n      // we've hit a filtered element and can ignore its children\n      return NodeFilter.FILTER_REJECT;\n    }\n\n    if (containsFilteredElement(node)) {\n      // we've hit a significant tree, so we'll have to keep investigating\n      return NodeFilter.FILTER_ACCEPT;\n    }\n\n    // we've found an insignificant tree\n    insiginificantBranches.push(node);\n    return NodeFilter.FILTER_REJECT;\n  };\n  // IE requires a function, Browsers require {acceptNode: function}\n  // see https://www.bennadel.com/blog/2607-finding-html-comment-nodes-in-the-dom-using-treewalker.htm\n  CollectInsignificantBranchesFilter.acceptNode = CollectInsignificantBranchesFilter;\n\n  const _document = getDocument(context);\n  // see https://developer.mozilla.org/en-US/docs/Web/API/Document/createTreeWalker\n  const walker = _document.createTreeWalker(\n    // root element to start search in\n    context,\n    // element type filter\n    NodeFilter.SHOW_ELEMENT,\n    // custom NodeFilter filter\n    CollectInsignificantBranchesFilter,\n    // deprecated, but IE requires it\n    false\n  );\n\n  while (walker.nextNode()) {\n    // collection things is happening through the filter method\n  }\n\n  return insiginificantBranches;\n}\n\nexport default function({context, filter} = {}) {\n  context = contextToElement({\n    label: 'get/insignificant-branches',\n    defaultToDocument: true,\n    context,\n  });\n\n  filter = nodeArray(filter);\n  if (!filter.length) {\n    throw new TypeError('get/insignificant-branches requires valid options.filter');\n  }\n\n  return queryInsignificantBranches({\n    context,\n    filter,\n  });\n}\n"]}