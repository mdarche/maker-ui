{"version":3,"sources":["../../src/maintain/tab-focus.js"],"names":["context","document","documentElement","event","preventDefault","sequence","backward","shiftKey","first","last","length","source","target","focus","currentIndex","found","some","element","index","offset"],"mappings":";;;;;;;;;;;;;;;;;;;oBAKe,YAA2B;AAAA,mFAAJ,EAAI;AAAA,QAAhBA,OAAgB,QAAhBA,OAAgB;;AACxC,QAAI,CAACA,OAAL,EAAc;AACZA,gBAAUC,SAASC,eAAnB;AACD;;AAED;AACA;AACA;AACA;;AAEA,WAAO,mBAAQ;AACb;AACA;AACA,yBAAmB,qBAASC,KAAT,EAAgB;AACjC;AACAA,cAAMC,cAAN;;AAEA,YAAMC,WAAW,2BAAiB;AAChCL;AADgC,SAAjB,CAAjB;;AAIA,YAAMM,WAAWH,MAAMI,QAAvB;AACA,YAAMC,QAAQH,SAAS,CAAT,CAAd;AACA,YAAMI,OAAOJ,SAASA,SAASK,MAAT,GAAkB,CAA3B,CAAb;;AAEA;AACA,YAAMC,SAASL,WAAWE,KAAX,GAAmBC,IAAlC;AACA,YAAMG,SAASN,WAAWG,IAAX,GAAkBD,KAAjC;AACA,YAAI,6BAAgBG,MAAhB,CAAJ,EAA6B;AAC3BC,iBAAOC,KAAP;AACA;AACD;;AAED;AACA,YAAIC,qBAAJ;AACA,YAAMC,QAAQV,SAASW,IAAT,CAAc,UAASC,OAAT,EAAkBC,KAAlB,EAAyB;AACnD,cAAI,CAAC,6BAAgBD,OAAhB,CAAL,EAA+B;AAC7B,mBAAO,KAAP;AACD;;AAEDH,yBAAeI,KAAf;AACA,iBAAO,IAAP;AACD,SAPa,CAAd;;AASA,YAAI,CAACH,KAAL,EAAY;AACV;AACAP,gBAAMK,KAAN;AACA;AACD;;AAED;AACA,YAAMM,SAASb,WAAW,CAAC,CAAZ,GAAgB,CAA/B;AACAD,iBAASS,eAAeK,MAAxB,EAAgCN,KAAhC;AACD;AA3CY,KAAR,CAAP;AA6CD,G","file":"tab-focus.js","sourcesContent":["\nimport isActiveElement from '../is/active-element';\nimport queryTabsequence from '../query/tabsequence';\nimport whenKey from '../when/key';\n\nexport default function({ context } = {}) {\n  if (!context) {\n    context = document.documentElement;\n  }\n\n  // Make sure the supports tests are run before intercepting the Tab key,\n  // or IE10 and IE11 will fail to process the first Tab key event. Not\n  // limiting this warm-up to IE because it may be a problem elsewhere, too.\n  queryTabsequence();\n\n  return whenKey({\n    // Safari on OSX may require ALT+TAB to reach links,\n    // see https://github.com/medialize/ally.js/issues/146\n    '?alt+?shift+tab': function(event) {\n      // we're completely taking over the Tab key handling\n      event.preventDefault();\n\n      const sequence = queryTabsequence({\n        context,\n      });\n\n      const backward = event.shiftKey;\n      const first = sequence[0];\n      const last = sequence[sequence.length - 1];\n\n      // wrap around first to last, last to first\n      const source = backward ? first : last;\n      const target = backward ? last : first;\n      if (isActiveElement(source)) {\n        target.focus();\n        return;\n      }\n\n      // find current position in tabsequence\n      let currentIndex;\n      const found = sequence.some(function(element, index) {\n        if (!isActiveElement(element)) {\n          return false;\n        }\n\n        currentIndex = index;\n        return true;\n      });\n\n      if (!found) {\n        // redirect to first as we're not in our tabsequence\n        first.focus();\n        return;\n      }\n\n      // shift focus to previous/next element in the sequence\n      const offset = backward ? -1 : 1;\n      sequence[currentIndex + offset].focus();\n    },\n  });\n}\n"]}