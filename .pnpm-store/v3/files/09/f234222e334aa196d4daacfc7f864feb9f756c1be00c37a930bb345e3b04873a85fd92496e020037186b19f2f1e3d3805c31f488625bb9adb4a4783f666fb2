{"version":3,"sources":["../../src/element/focus.js"],"names":["context","defaultToAncestor","undoScrolling","element","label","targetIsFocusable","rules","except","target","_undoScrolling","result","focus","_window","HTMLElement","prototype","call","e","actionPerformed","flexbox","scrollable","onlyTabbable"],"mappings":";;;;;;;;;;;;;;;;;;;oBA2Ce,UAASA,OAAT,EAGP;AAAA,mFAAJ,EAAI;AAAA,QAFNC,iBAEM,QAFNA,iBAEM;AAAA,QADNC,aACM,QADNA,aACM;;AACN,QAAMC,UAAU,gCAAiB;AAC/BC,aAAO,eADwB;AAE/BJ;AAF+B,KAAjB,CAAhB;;AAKA,QAAMK,oBAAoB,oBAAYC,KAAZ,CAAkB;AAC1CN,eAASG,OADiC;AAE1CI;AAF0C,KAAlB,CAA1B;;AAKA,QAAI,CAACN,iBAAD,IAAsB,CAACI,iBAA3B,EAA8C;AAC5C,aAAO,IAAP;AACD;;AAED,QAAMG,SAAS,2BAAe;AAC5BR,eAASG,OADmB;AAE5BI;AAF4B,KAAf,CAAf;;AAKA,QAAI,CAACC,MAAL,EAAa;AACX,aAAO,IAAP;AACD;;AAED,QAAI,6BAAgBA,MAAhB,CAAJ,EAA6B;AAC3B,aAAOA,MAAP;AACD;;AAED,QAAIC,uBAAJ;AACA,QAAIP,aAAJ,EAAmB;AACjBO,uBAAiB,8BAAeD,MAAf,CAAjB;AACD;;AAED,QAAME,SAASC,MAAMH,MAAN,CAAf;;AAEAC,sBAAkBA,gBAAlB;;AAEA,WAAOC,MAAP;AACD,G;;;;;;;;;;;;;;;;;;;;;;AAzED,WAASC,KAAT,CAAeR,OAAf,EAAwB;AACtB,QAAIA,QAAQQ,KAAZ,EAAmB;AACjBR,cAAQQ,KAAR;AACA,aAAO,6BAAgBR,OAAhB,IAA2BA,OAA3B,GAAqC,IAA5C;AACD;;AAED,QAAMS,UAAU,yBAAUT,OAAV,CAAhB;;AAEA,QAAI;AACF;AACA;AACA;AACA;AACA;AACAS,cAAQC,WAAR,CAAoBC,SAApB,CAA8BH,KAA9B,CAAoCI,IAApC,CAAyCZ,OAAzC;AACA,aAAO,6BAAgBA,OAAhB,IAA2BA,OAA3B,GAAqC,IAA5C;AACD,KARD,CAQE,OAAOa,CAAP,EAAU;AACV,UAAMC,kBAAkB,qBAA0Bd,OAA1B,CAAxB;AACA,aAAOc,mBAAmB,6BAAgBd,OAAhB,CAAnB,GAA8CA,OAA9C,GAAwD,IAA/D;AACD;AACF;AA9BD;;AAgCA,MAAMI,SAAS;AACb;AACAW,aAAS,IAFI;AAGb;AACA;AACAC,gBAAY,IALC;AAMb;AACAC,kBAAc;AAPD,GAAf","file":"focus.js","sourcesContent":["\n// wrapper for HTMLElement.prototype.focus\n\nimport focusSvgForeignObjectHack from './focus.svg-foreign-object-hack';\nimport getFocusTarget from '../get/focus-target';\nimport isActiveElement from '../is/active-element';\nimport isFocusable from '../is/focusable';\nimport contextToElement from '../util/context-to-element';\nimport getWindow from '../util/get-window';\nimport resetScrolling from '../util/reset-scrolling';\n\nfunction focus(element) {\n  if (element.focus) {\n    element.focus();\n    return isActiveElement(element) ? element : null;\n  }\n\n  const _window = getWindow(element);\n\n  try {\n    // The element itself does not have a focus method.\n    // This is true for SVG elements in Firefox and IE,\n    // as well as MathML elements in every browser.\n    // IE9 - 11 will let us abuse HTMLElement's focus method,\n    // Firefox and Edge will throw an error.\n    _window.HTMLElement.prototype.focus.call(element);\n    return isActiveElement(element) ? element : null;\n  } catch (e) {\n    const actionPerformed = focusSvgForeignObjectHack(element);\n    return actionPerformed && isActiveElement(element) ? element : null;\n  }\n}\n\nconst except = {\n  // exclude elements affected by the IE flexbox bug\n  flexbox: true,\n  // exclude overflowing elements that are not intentionally\n  // made focusable by adding a tabindex attribute\n  scrollable: true,\n  // include elements that don't have a focus() method\n  onlyTabbable: true,\n};\n\nexport default function(context, {\n  defaultToAncestor,\n  undoScrolling,\n} = {}) {\n  const element = contextToElement({\n    label: 'element/focus',\n    context,\n  });\n\n  const targetIsFocusable = isFocusable.rules({\n    context: element,\n    except,\n  });\n\n  if (!defaultToAncestor && !targetIsFocusable) {\n    return null;\n  }\n\n  const target = getFocusTarget({\n    context: element,\n    except,\n  });\n\n  if (!target) {\n    return null;\n  }\n\n  if (isActiveElement(target)) {\n    return target;\n  }\n\n  let _undoScrolling;\n  if (undoScrolling) {\n    _undoScrolling = resetScrolling(target);\n  }\n\n  const result = focus(target);\n\n  _undoScrolling && _undoScrolling();\n\n  return result;\n}\n"]}