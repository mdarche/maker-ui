{"version":3,"sources":["../../src/supports/supports-cache.js"],"names":["readLocalStorage","key","data","window","localStorage","getItem","JSON","parse","e","writeLocalStorage","value","document","hasFocus","removeItem","setItem","stringify","userAgent","navigator","cacheKey","cache","version","get","set","values","Object","keys","forEach","time","Date","toISOString"],"mappings":";;;;;;AAQA;;;;;;AAEA,SAASA,gBAAT,CAA0BC,GAA1B,EAA+B;AAC7B;AACA;AACA,MAAIC,aAAJ;;AAEA,MAAI;AACFA,WAAOC,OAAOC,YAAP,IAAuBD,OAAOC,YAAP,CAAoBC,OAApB,CAA4BJ,GAA5B,CAA9B;AACAC,WAAOA,OAAOI,KAAKC,KAAL,CAAWL,IAAX,CAAP,GAA0B,EAAjC;AACD,GAHD,CAGE,OAAOM,CAAP,EAAU;AACVN,WAAO,EAAP;AACD;;AAED,SAAOA,IAAP;AACD,C,CAvBD;;;;;;;;AAyBA,SAASO,iBAAT,CAA2BR,GAA3B,EAAgCS,KAAhC,EAAuC;AACrC,MAAI,CAACC,SAASC,QAAT,EAAL,EAA0B;AACxB;AACA;AACA;AACA,QAAI;AACFT,aAAOC,YAAP,IAAuBD,OAAOC,YAAP,CAAoBS,UAApB,CAA+BZ,GAA/B,CAAvB;AACD,KAFD,CAEE,OAAOO,CAAP,EAAU;AACV;AACD;;AAED;AACD;;AAED,MAAI;AACFL,WAAOC,YAAP,IAAuBD,OAAOC,YAAP,CAAoBU,OAApB,CAA4Bb,GAA5B,EAAiCK,KAAKS,SAAL,CAAeL,KAAf,CAAjC,CAAvB;AACD,GAFD,CAEE,OAAOF,CAAP,EAAU;AACV;AACD;AACF;;AAED,IAAMQ,YAAY,OAAOb,MAAP,KAAkB,WAAlB,IAAiCA,OAAOc,SAAP,CAAiBD,SAAlD,IAA+D,EAAjF;AACA,IAAME,WAAW,qBAAjB;AACA,IAAIC,QAAQnB,iBAAiBkB,QAAjB,CAAZ;;AAEA;AACA,IAAIC,MAAMH,SAAN,KAAoBA,SAApB,IAAiCG,MAAMC,OAAN,sBAArC,EAAgE;AAC9DD,UAAQ,EAAR;AACD;;AAEDA,MAAMH,SAAN,GAAkBA,SAAlB;AACAG,MAAMC,OAAN;;kBAEe;AACbC,OAAK,eAAW;AACd,WAAOF,KAAP;AACD,GAHY;AAIbG,OAAK,aAASC,MAAT,EAAiB;AACpBC,WAAOC,IAAP,CAAYF,MAAZ,EAAoBG,OAApB,CAA4B,UAASzB,GAAT,EAAc;AACxCkB,YAAMlB,GAAN,IAAasB,OAAOtB,GAAP,CAAb;AACD,KAFD;;AAIAkB,UAAMQ,IAAN,GAAa,IAAIC,IAAJ,GAAWC,WAAX,EAAb;AACApB,sBAAkBS,QAAlB,EAA4BC,KAA5B;AACD;AAXY,C","file":"supports-cache.js","sourcesContent":["/*\n    Facility to cache test results in localStorage.\n\n    USAGE:\n      cache.get('key');\n      cache.set('key', 'value');\n */\n\nimport version from '../version';\n\nfunction readLocalStorage(key) {\n  // allow reading from storage to retrieve previous support results\n  // even while the document does not have focus\n  let data;\n\n  try {\n    data = window.localStorage && window.localStorage.getItem(key);\n    data = data ? JSON.parse(data) : {};\n  } catch (e) {\n    data = {};\n  }\n\n  return data;\n}\n\nfunction writeLocalStorage(key, value) {\n  if (!document.hasFocus()) {\n    // if the document does not have focus when tests are executed, focus() may\n    // not be handled properly and events may not be dispatched immediately.\n    // This can happen when a document is reloaded while Developer Tools have focus.\n    try {\n      window.localStorage && window.localStorage.removeItem(key);\n    } catch (e) {\n      // ignore\n    }\n\n    return;\n  }\n\n  try {\n    window.localStorage && window.localStorage.setItem(key, JSON.stringify(value));\n  } catch (e) {\n    // ignore\n  }\n}\n\nconst userAgent = typeof window !== 'undefined' && window.navigator.userAgent || '';\nconst cacheKey = 'ally-supports-cache';\nlet cache = readLocalStorage(cacheKey);\n\n// update the cache if ally or the user agent changed (newer version, etc)\nif (cache.userAgent !== userAgent || cache.version !== version) {\n  cache = {};\n}\n\ncache.userAgent = userAgent;\ncache.version = version;\n\nexport default {\n  get: function() {\n    return cache;\n  },\n  set: function(values) {\n    Object.keys(values).forEach(function(key) {\n      cache[key] = values[key];\n    });\n\n    cache.time = new Date().toISOString();\n    writeLocalStorage(cacheKey, cache);\n  },\n};\n"]}